function BoxMan(t){var e=this;this.addedEventFuncs={},this.globalObjSetup={},this.globalBoxSetup={},this.globalExBoxSetup={},this.objs={},this.boxObjs={},this.exBoxObjs={},this.metaObj={mvObj:void 0,isOnDown:!1,isOnMoving:!1,lastPosX:0,lastPosY:0,mvObjPreviewClone:void 0,mvObjStartBodyOffset:void 0,mvObjCloneList:[],cam:{w:window.innerWidth,h:window.innerHeight},limit:2,layerOnMove:void 0,isCopy:!1,isOverwrite:!1,isBoxToBox:!0,appendType:this.APPEND_TYPE_PUSH},window.addEventListener("load",function(t){e.setMaxSize(),e.isMobile()?(getEl(document).addEventListener("touchstart",function(t){e.whenMouseDown(t)}),getEl(document).addEventListener("touchmove",function(t){e.whenMouseMove(t)}),getEl(document).addEventListener("touchend",function(t){e.whenMouseUp(t)})):(getEl(document).addEventListener("mousedown",function(t){e.whenMouseDown(t)}),getEl(document).addEventListener("mousemove",function(t){e.whenMouseMove(t)}),getEl(document).addEventListener("mouseup",function(t){e.whenMouseUp(t)}),window.addEventListener("resize",function(t){e.whenResize(t)}))})}window.getNewEl=function(t,e,o,n,i,r,a){var s=document.createElement(t);e&&(s.id=e),o&&s.setAttribute("class",o);for(var d in n)s.setAttribute(d,n[d]);return i&&(s.innerHTML=i),r&&getEl(s).addEventListener(r,function(t){a(t)}),s},window.getEl=function(t){var e="object"==typeof t?t:document.getElementById(t);return this.obj=e,this.attr=function(t,o){return o?(e.setAttribute(t,o),this):e.getAttribute(t)},this.clas=function(){var t={has:function(t){return e.className.indexOf(t)!=-1},add:function(o){return e.classList?e.classList.add(o):e.className+=" "+o+" ",t},remove:function(o){if(e.classList)e.classList.remove(o);else{for(var n=e.className.split(" ");n.indexOf(o)!=-1;)n.splice(n.indexOf(o),1);e.className=n.join(" ")}return t}};return t}(),this.add=function(t){return"object"==typeof t?e.appendChild(t):e.innerHTML+=t,this},this.addln=function(t){return"object"==typeof t?e.appendChild(t):e.innerHTML+=t?t:"",e.appendChild(document.createElement("br")),this},this.hasEventListener=function(t){return e.hasEventListener(t)},this.removeEventListener=function(t,o){return e.removeEventListener(t,o),this},this.addEventListener=function(t,o){navigator.userAgent.indexOf("Firefox")!=-1&&e.addEventListener(t,function(t){window.event=t},!0),e.addEventListener?e.addEventListener(t,function(t){o(t)}):e.attachEvent("on"+t,function(t){!t.target&&t.srcElement&&(t.target=t.srcElement),o(t)})},this.del=function(t){return e.removeChild(t),this},this.html=function(t){return e.innerHTML=t,this},this.clear=function(){return e.innerHTML="",this},this.scrollDown=function(){return e.scrollTop=e.scrollHeight,this},this.disableSelection=function(){return"undefined"!=typeof e.ondragstart&&(e.ondragstart=function(){return!1}),"undefined"!=typeof e.onselectstart&&(e.onselectstart=function(){return!1}),"undefined"!=typeof e.oncontextmenu&&(e.oncontextmenu=function(){return!1}),"undefined"!=typeof e.style.MozUserSelect&&(document.body.style.MozUserSelect="none"),this},this.hideDiv=function(){return e.style.display="block",e.style.position="absolute",e.style.left="-5555px",e.style.top="-5555px",this},this.showDiv=function(){return e.style.display="block",e.style.position="absolute",e.style.left="0px",e.style.top="0px",this},this.getNewSeqId=function(t){for(var o=1;o<5e4;o++){var n=t+o;if(!(n in e))return n}return null},this.isAccepted=function(t,e){var o=!1;return t?this.find(t)&&(o=!0):o=!0,e&&this.find(e)&&(o=!1),o},this.find=function(t){if(e instanceof Array){for(var o=[],n=0;n<e.length;n++){var i=this.getMatchedObjWithParam(e[n],t);i&&o.push(i)}return o}if(e instanceof Object){var i=this.getMatchedObjWithParam(e,t);return i}},this.getMatchedObjWithParam=function(t,e){if("string"==typeof e&&(e={id:e}),e instanceof Array){for(var o=0;o<e.length;o++)if(this.find(e[o]))return t}else if(e instanceof Object){for(var n=Object.keys(e),o=0;o<n.length;o++){var i=n[o];if(!t[i]||t[i]!=e[i])return}return t}},this.findDomDataAttribute=function(t){if(e instanceof Array){for(var o=[],n=0;n<e.length;n++){var i=this.getMatchedDomWithParam(e[n],t);i&&o.push(i)}return o}if(e instanceof Object){var i=this.getMatchedDomWithParam(e,t);return i}},this.getMatchedDomWithParam=function(t,e){if("string"==typeof e&&(e={id:e}),e instanceof Array){for(var o=0;o<e.length;o++)if(this.findDomDataAttribute(e[o]))return t}else if(e instanceof Object){for(var n=Object.keys(e),i="data-",o=0;o<n.length;o++){var r=n[o];if(!t.getAttribute(i+r)||t.getAttribute(i+r)!=e[r])return}return t}},this.getParentEl=function(t){for(var o=e;o&&void 0==o.getAttribute(t);)o=o.parentNode;return o},this.findEl=function(t,o){for(var n=e.children,i=0;i<n.length;i++)if(n[i].getAttribute(t)==o)return n[i]},this.findParentEl=function(t,o){for(var n,i=e;i;){if(i==document.body.parentNode){n=null;break}if(i.getAttribute(t)==o){n=i;break}i=i.parentNode}return n},this},window.getData=function(t){var t=t;return this.parse=function(){if(t){var e=t.substr(0,1),o=t.substr(t.length-1,1);if("string"==typeof t){if("{"==e&&"}"==o)return JSON.parse(t);if("["==e&&"]"==o)return JSON.parse(t);if(t.indexOf(",")!=-1){for(var n=t.split(","),i=0;i<n.length;i++)n[i]=n[i].trim();return n}}return t}},this},function(){for(var t=0,e=["ms","moz","webkit","o"],o=0;o<e.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[e[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[o]+"CancelAnimationFrame"]||window[e[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,o){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),r=window.setTimeout(function(){e(n+i)},i);return t=n+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(){window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder}(),function(){navigator.userAgent.indexOf("Firefox")!=-1&&window.addEventListener(eventNm,function(t){window.event=t},!0),!window.addEventListener&&window.attachEvent&&(window.addEventListener=function(t,e){window.attachEvent("on"+t,function(t){!t.target&&t.srcElement&&(t.target=t.srcElement),t.preventDefault||(t.preventDefault=function(){}),t.stopPropagation||(t.stopPropagation=function(){t.returnValue=!1,t.cancelBubble=!0}),e(t)})})}(),function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1})}(),function(){document.querySelectorAll||document.getElementsByTagName&&(document.querySelectorAll=function(){var t,e=selector.indexOf("["),o=selector.indexOf("]"),n=[];if(e!=-1&&o!=-1){t=selector.substring(e+1,o);for(var i=["div","span","form","input","select","textarea"],r=0;r<i.length;r++)for(var a=document.getElementsByTagName(i[r]),s=0;s<a.length;s++)void 0!=a[s].getAttribute(t)&&n.push(a[s])}return n})}(),function(){window.getComputedStyle||(window.getComputedStyle=function(t){return t.currentStyle})}(),function(){JSON||(JSON.stringify=JSON.stringify||function(t){var e=typeof t;if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var o,n,i=[],r=t&&t.constructor==Array;for(o in t)n=t[o],e=typeof n,"string"==e?n='"'+n+'"':"object"==e&&null!==n&&(n=JSON.stringify(n)),i.push((r?"":'"'+o+'":')+String(n));return(r?"[":"{")+String(i)+(r?"]":"}")},JSON.parse=JSON.parse||function(str){return""===str&&(str='""'),eval("var p="+str+";"),p})}(),BoxMan.prototype.APPEND_TYPE_LAST=1,BoxMan.prototype.APPEND_TYPE_FIRST=2,BoxMan.prototype.APPEND_TYPE_PUSH=3,BoxMan.prototype.set=function(t,e){"box"==t?this.globalBoxSetup=e:"exbox "==t?this.globalExBoxSetup=e:"obj"==t&&(this.globalObjSetup=e)},BoxMan.prototype["new"]=function(t,e){"box"==t?this.newBox(e):"exbox"==t?this.newExBox(e):"obj"==t&&this.newObj(e)},BoxMan.prototype.detect=function(){var t;t=document.querySelectorAll("[data-box]");for(var e=0;e<t.length;e++)this.addBox(t[e]);t=document.querySelectorAll("[data-exbox]");for(var e=0;e<t.length;e++)this.addExBox(t[e]);t=document.querySelectorAll("[data-obj]");for(var e=0;e<t.length;e++)this.addObj(t[e])},BoxMan.prototype.addEventListener=function(t,e){this.addedEventFuncs[t]||(this.addedEventFuncs[t]=[]),this.addedEventFuncs[t].push(e)},BoxMan.prototype.execEvent=function(t,e){var o=this.addedEventFuncs[t];if(o)for(var n=0;n<o.length;n++)o[n](e)},BoxMan.prototype.addBox=function(t){null==t.getAttribute("data-box")&&void 0==t.getAttribute("data-box")&&t.setAttribute("data-box","");var e={id:t.getAttribute("data-box-id"),limit:t.getAttribute("data-limit"),acceptbox:getData(t.getAttribute("data-accept-box")).parse(),rejectbox:getData(t.getAttribute("data-reject-box")).parse(),acceptobj:getData(t.getAttribute("data-accept-obj")).parse(),rejectobj:getData(t.getAttribute("data-reject-obj")).parse(),beforeboxin:t.getAttribute("data-event-beforeboxin"),boxinout:t.getAttribute("data-event-boxinout"),start:t.getAttribute("data-event-start"),boxin:t.getAttribute("data-event-boxin"),boxout:t.getAttribute("data-event-boxout")};this.setBox(t,e)},BoxMan.prototype.newBox=function(t){var e=getNewEl("div","","",{"data-box":"true"},"");return parentEl=t.parentEl?t.parentEl:document.body,this.setBox(e,t,parentEl),e},BoxMan.prototype.setBox=function(t,e,o){if(e=e?e:{},t.isAdaptedBox)return!1;t.isAdaptedBox=!0,getEl(t).clas.add("sj-obj-box");var n=this.boxObjs,i=e.id?e.id:getEl(n).getNewSeqId("tmp");t.boxid=i,this.boxObjs[i]=e,this.boxObjs[i].el=t,this.boxObjs[i].id=i;var r=this.globalBoxSetup,a=e?e:{};for(var s in r)a[s]||(a[s]=r[s]);return a&&(a.imgURL&&(t.style.background='url("'+a.imgURL+'")'),a.width&&a.height&&(t.style.backgroundSize=a.width+" "+a.height),a.width&&(t.style.width=a.width),a.height&&(t.style.height=a.height),a.content&&(t.innerHTML=a.content)),o&&getEl(o).add(t),a.beforeboxin&&(t.executeEventBeforeboxin=new Function("box","obj","boxsize",eventFn)),a.beforeboxinout&&(t.executeEventBoxinout=new Function("box","obj","boxSize","boxBefore",eventFn)),a.start&&(t.executeEventStart=new Function("box","obj","boxSize",eventFn),t.executeEventStart(obj,void 0,this.getMovableObjCount(obj))),a.boxin&&(t.executeEventBoxin=new Function("box","obj","boxSize","boxBefore",eventFn)),a.boxout&&(t.executeEventBoxout=new Function("box","obj","boxSize",eventFn)),i},BoxMan.prototype.getBox=function(t){return"string"==typeof t?this.getBoxById(t):this.getBoxByEl(t)},BoxMan.prototype.getBoxById=function(t){return this.boxObjs[t]},BoxMan.prototype.getBoxByEl=function(t){var e=this.boxObjs;if(t&&t.boxid){var o=t.boxid,n=e[o];return n}},BoxMan.prototype.addExBox=function(t){null==t.getAttribute("data-exbox")&&void 0==t.getAttribute("data-exbox")&&t.setAttribute("data-exbox","");var e={id:t.getAttribute("data-exbox-id")};this.setExBox(t,e)},BoxMan.prototype.newExBox=function(t){var e=getNewEl("div","","",{"data-exbox":"true"},"");return parentEl=t.parentEl?t.parentEl:document.body,this.setBox(e,t,parentEl),e},BoxMan.prototype.setExBox=function(t,e,o){if(e=e?e:{},t.isAdaptedExBox)return!1;t.isAdaptedExBox=!0,getEl(t).clas.add("sj-obj-exbox");var n=this,i=this.exBoxObjs,r=e.id?e.id:getEl(i).getNewSeqId("tmp");t.exboxid=r,this.exBoxObjs[r]=e,this.exBoxObjs[r].el=t,this.exBoxObjs[r].id=r;var a=this.globalExBoxSetup,s=e?e:{};for(var d in a)s[d]||(s[d]=a[d]);s&&(s.imgURL&&(t.style.background='url("'+s.imgURL+'")'),s.width&&s.height&&(t.style.backgroundSize=s.width+" "+s.height),s.width&&(t.style.width=s.width),s.height&&(t.style.height=s.height),s.content&&(t.innerHTML=s.content)),o&&getEl(o).add(t),getEl(t).clas.add("sj-obj-exbox"),getEl(t).addEventListener("dragenter",n.handleDragOver(n)),getEl(t).addEventListener("dragover",n.handleDragOver(n)),getEl(t).addEventListener("dragleave",n.handleDragOut(n)),getEl(t).addEventListener("drop",n.handleDrop(n));var u=t.getAttribute("data-exbox");return null!=u&&void 0!=u&&n.addEventListener("drop",new Function("event",u)),r},BoxMan.prototype.getExBox=function(t){return"string"==typeof t?this.getExBoxById(t):this.getExBoxByEl(t)},BoxMan.prototype.getExBoxById=function(t){return this.exBoxObjs[t]},BoxMan.prototype.getExBoxByEl=function(t){var e=this.exBoxObjs;if(t&&t.exboxid){var o=t.exboxid,e=e[o];return e}},BoxMan.prototype.handleDragOver=function(t){return function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy";var e=t.target;e.style.background="#ffdddd"}},BoxMan.prototype.handleDragOut=function(t){return function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy";var e=t.target;e.style.background=""}},BoxMan.prototype.handleDrop=function(t){return function(e){e.stopPropagation(),e.preventDefault();var o=e.originalEvent?e.originalEvent.dataTransfer.files:e.dataTransfer?e.dataTransfer.files:"";e.exbox={files:o},t.execEvent("drop",e),e.target.style.background=""}},BoxMan.prototype.addObj=function(t){var e={objid:t.getAttribute("data-obj-id")};this.setObj(t,e)},BoxMan.prototype.newObj=function(t){var e=getNewEl("div","","",{"data-obj":"true"},"");return parentEl=t.parentEl?t.parentEl:document.body,this.setObj(e,t,parentEl),e},BoxMan.prototype.setObj=function(t,e,o){if(e=e?e:{},t.isAdaptedMovable)return!1;t.isAdaptedMovable=!0,getEl(t).clas.add("sj-obj-movable");var n=this,i=this.objs,r=e.id?e.id:getEl(i).getNewSeqId("tmp");t.objid=r,this.objs[r]=e,this.objs[r].el=t,this.objs[r].id=r;var a=this.globalObjSetup,s=e?e:{};for(var d in a)s[d]||(s[d]=a[d]);return s&&(s.imgURL&&(t.style.background='url("'+s.imgURL+'")'),s.width&&s.height&&(t.style.backgroundSize=s.width+" "+s.height),s.width&&(t.style.width=s.width),s.height&&(t.style.height=s.height),s.content&&(t.innerHTML=s.content)),t.style.left=t.offsetLeft+"px",t.style.top=t.offsetTop+"px",o&&getEl(o).add(t),this.isMobile()?getEl(t).addEventListener("touchstart",function(e){n.objStartMove(e,t)}):getEl(t).addEventListener("mousedown",function(e){n.objStartMove(e,t)}),getEl(t).addEventListener("click",function(){}),r},BoxMan.prototype.getObj=function(t){return"string"==typeof t?this.getObjById(t):this.getObjByEl(t)},BoxMan.prototype.getObjById=function(t){return this.objs[t]},BoxMan.prototype.getObjByEl=function(t){var e=this.objs;if(t&&t.objid){var o=t.objid,n=e[o];return n}},BoxMan.prototype.hasEvent=function(t){var e=this.addedEventFuncs[t];return e&&e.length>0},BoxMan.prototype.whenMouseDown=function(t){var e=this.metaObj;return e.isOnMoving=!1,!0},BoxMan.prototype.objStartMove=function(t,e){var o,n=this.metaObj;if(navigator.userAgent.indexOf("Firefox")!=-1&&t.preventDefault(),e!=window)o=e;else{var i=getEl(t.target).getParentEl("data-obj");i&&(o=i)}n.mvObj=o,this.createPreviewer(o),this.saveInfoBeforeMove(o,t)},BoxMan.prototype.whenMouseMove=function(t){var e=this.metaObj,o=e.mvObj;this.setLastPos(t),e.timerObj&&!this.isInBox(e.timerObj,e.lastPosX,e.lastPosY)&&this.removeTimer(),e.isOnDown&&(t.preventDefault(),this.setPreviewer(o,t),this.setMovingState(o))},BoxMan.prototype.whenMouseUp=function(t){var e=this.metaObj,o=(e.mvObjBeforeBox,e.mvObj);if(this.removeTimer(),e.isOnDown&&(getEl(o).clas.remove("sj-obj-is-on-moving"),e.isOnDown=!1),e.isOnMoving){var n=this.getDecidedBox(o,this.boxObjs,e.lastPosX,e.lastPosY);n=n?n:e.layerOnMove,this.deletePreviewer(),this.moveObjTo(o,n),o=null}},BoxMan.prototype.getDecidedBox=function(t,e,o,n){var i,r,a=[],s=0,d=0;for(var u in e){var l=e[u].el;this.isInBox(l,o,n)&&t!=l&&a.push(l)}for(var f=0;f<a.length;f++){var c=a[f].parentNode,b=0,p=!1,h=!1;for("fixed"==a[f].style.position&&(h=!0);c;){if(c==t){p=!0;break}if(!this.isInBox(c,o,n)&&c!=document.body&&c!=document.body.parentNode&&c!=document.body.parentNode.parentNode){p=!0;break}c.style&&"fixed"==c.style.position&&(h=!0),c=c.parentNode,b++}p||(h?d<b&&(d=b,r=a[f]):s<b&&(s=b,i=a[f]))}return r?r:i},BoxMan.prototype.getMovableObjCount=function(t){var e=0;if(t)for(var o=0;o<t.children.length;o++){var n=t.children[o].getAttribute("data-obj");null!=n&&void 0!=n&&"false"!=n&&e++}return e},BoxMan.prototype.getMovableObj=function(t,e){if(t)for(var o=0;o<t.children.length;o++){var n=t.children[o],i=n.getAttribute("data-obj"),r=n.getAttribute("data-obj-previewer");if(null!=r||null!=i&&void 0!=i&&"false"!=i){var a=(this.getBodyOffset(n),this.metaObj);if(this.isInBox(n,a.lastPosX,a.lastPosY))return n}}},BoxMan.prototype.saveInfoBeforeMove=function(t,e){var o=this.metaObj;o.mvObjBeforeBox=t.parentNode,o.mvObjBeforePosition=t.style.position,o.mvObjBeforeNextSibling=t.nextSibling,o.mvObjStartBodyOffset=this.getBodyOffset(t),this.setLastPos(e),void 0!=e.touches?(o.timerObj=e.touches[0].target,this.removeTimer(),o.timer=setInterval(setTimer,100),t.adjustX=e.touches[0].pageX-o.mvObjStartBodyOffset.x,t.adjustY=e.touches[0].pageY-o.mvObjStartBodyOffset.y):(t.adjustX=e.clientX-o.mvObjStartBodyOffset.x+this.getBodyScrollX(),t.adjustY=e.clientY-o.mvObjStartBodyOffset.y+this.getBodyScrollY(),getEl(t).clas.add("sj-obj-is-on-moving"),o.isOnDown=!0,o.isOnMoving=!1)},BoxMan.prototype.setMovingState=function(t){var e=this.metaObj,o=e.lastPosX,n=e.lastPosY,i=e.cam,r="px";o-t.adjustX>=1&&o-t.adjustX+t.offsetWidth<=i.w?t.style.left=o-t.adjustX+r:(o-t.adjustX<1&&(t.style.left=0+r),o-t.adjustX+t.offsetWidth>i.w&&(t.style.left=i.w-t.offsetWidth+r)),n-t.adjustY>=1&&n-t.adjustY+t.offsetHeight<=i.h?t.style.top=n-t.adjustY+r:(n-t.adjustY<1&&(t.style.top=0+r),n-t.adjustY+t.offsetHeight>i.h&&(t.style.top=i.h-t.offsetHeight+r)),t.style.position="absolute",t.style["float"]="",getEl(t).clas.add("sj-obj-is-on-moving"),document.body.appendChild(t),e.isOnMoving||((t.adjustX>t.offsetWidth||t.adjustX<0)&&(t.adjustX=t.offsetWidth),(t.adjustY>t.offsetHeight||t.adjustY<0)&&(t.adjustY=t.offsetHeight)),e.isOnMoving=!0},BoxMan.prototype.moveObjTo=function(t,e){var o=this.metaObj,n=o.mvObjBeforeBox,i=(o.mvObjBeforeNextSibling,o.mvObjBeforePosition,o.mvObjStartBodyOffset,o.mvObjPreviewClone),r=this.getBox(n),a=this.getBox(e),s=this.getObj(t),d=void 0!=r,u=void 0!=a,l=u&&void 0!=e.getAttribute("data-tree-type"),f=u&&(a.limit>this.getMovableObjCount(e)||void 0==a.limit),c=r==a,b=o.appendType==this.APPEND_TYPE_PUSH,p=!b&&(c||!f),h=b&&!f&&!c,v=u&&e.executeEventBeforeboxin&&!e.executeEventBeforeboxin(e,t,this.getMovableObjCount(n)),x=o.isBoxToBox&&!u&&d,g=!u||getEl(r).isAccepted(a.acceptbox,a.rejectbox),m=!u||getEl(s).isAccepted(a.acceptobj,a.rejectobj),y=!1,j=!1,B=!1;if(p||v||x||!g||!m)this.backToBefore(t,n,o.appendType);else if(l){if(getEl(e).clas.remove("sj-tree-box-to-go"),e.executeEventDrop){targetTree=sj.treeMan.get(e.sjid),targetTree.repository[t.sjid]=sj.objMan.get(t.sjid),t.parentNode.removeChild(t);var E={mvObj:t,obj:sj.objMan.get(t.sjid),decidedBox:e,treeObj:targetTree,mvObjBeforeBox:n,path:sj.treeMan.getPath(e.sjid)};e.executeEventDrop(event,E)}}else if(e){if(h)return void this.backToBefore(t,n,o.appendType);var O;if(o.isOverwrite&&!c&&(e.innerHTML=""),o.isCopy&&!c){var w=t.cloneNode(!0);this.setObj("",w),O=w,this.backToBefore(t,n,o.appendType)}else O=t;this.goTo(O,e,o.appendType,i),y=!0,j=!0,B=!0}if(y||!x&&u){var M=this.getMovableObjCount(n);n.executeEventMustDo&&n.executeEventMustDo(),n.executeEventBoxinout&&n.executeEventBoxinout(n,t,M),n.executeEventBoxout&&n.executeEventBoxout(n,t,M)}if(j){var T=this.getMovableObjCount(e);e.executeEventMustDo&&e.executeEventMustDo(),e.executeEventBoxinout&&e.executeEventBoxinout(e,t,T,n),e.executeEventBoxin&&e.executeEventBoxin(e,t,T,n)}return t=null,B},BoxMan.prototype.goTo=function(t,e,o,n){if(o==this.APPEND_TYPE_LAST)e.appendChild(t);else if(o==this.APPEND_TYPE_FIRST)e.insertBefore(t,e.firstChild);else if(o==this.APPEND_TYPE_PUSH){var i=this.getMovableObj(e,event);i?i==n.nextSibling?e.insertBefore(t,i.nextSibling):i!=n&&e.insertBefore(t,i):e.appendChild(t)}t.style.position=""},BoxMan.prototype.backToBefore=function(t,e,o){var n=this.metaObj,i=n.mvObjBeforeNextSibling,r=n.mvObjBeforePosition,a=n.mvObjStartBodyOffset;e.insertBefore(t,i),t.style.position="absolute"==r?"absolute":"","absolute"==r&&(t.style.left=a.x+"px",t.style.top=a.y+"px",t.style["float"]="")},BoxMan.prototype.createPreviewer=function(t){var e=this.metaObj,o=t.cloneNode(!0);o.setAttribute("data-obj","false"),o.setAttribute("data-obj-previewer","true"),getEl(o).clas.add("sj-preview-going-to-be-in-box"),o.style.position="",e.mvObjPreviewClone=o,e.mvObjCloneList.push(o)},BoxMan.prototype.setPreviewer=function(t,e){var o=this.metaObj,n=o.lastGoingToBeInThisBox,i=o.mvObjPreviewClone,r=o.mvObjBeforeBox,a=this.getDecidedBox(t,this.boxObjs,o.lastPosX,o.lastPosY),s=a,d=this.getBox(r),u=this.getBox(s),l=this.getObj(t),f=void 0!=d,c=void 0!=u,b=c&&void 0!=s.getAttribute("data-tree-type"),p=c&&(u.limit>this.getMovableObjCount(s)||void 0==u.limit),h=d==u,v=o.appendType==this.APPEND_TYPE_PUSH,x=!v&&(h||!p),g=v&&!p&&!h,m=(c&&s.executeEventBeforeboxin&&!s.executeEventBeforeboxin(s,t,this.getMovableObjCount(r)),o.isBoxToBox&&!c&&f),y=!c||getEl(d).isAccepted(u.acceptbox,u.rejectbox),j=!c||getEl(l).isAccepted(u.acceptobj,u.rejectobj);if(b)n&&getEl(n).clas.remove("sj-tree-box-to-go"),getEl(a).clas.add("sj-tree-box-to-go"),o.lastGoingToBeInThisBox=a;else if(x||m||!y||!j)this.backToBefore(i,r,o.appendType),o.lastGoingToBeInThisBox=a;else if(s){if(g)return void this.backToBefore(i,r,o.appendType);this.goTo(i,a,o.appendType,i),o.lastGoingToBeInThisBox=a}else n&&getEl(n).clas.remove("sj-tree-box-to-go"),i.parentNode&&i.parentNode.removeChild(i)},BoxMan.prototype.deletePreviewer=function(){var t=this.metaObj,e=t.mvObjPreviewClone,o=t.mvObjCloneList;e&&e.parentNode&&(e.parentNode.removeChild(e),e=void 0);for(var n=0;n<o.length;n++)o[n].parentNode&&o[n].parentNode.removeChild(o[n]);o.length>3&&(o=[])},BoxMan.prototype.isMobile=function(){var t="win16|win32|win64|mac",e=!1;return navigator.platform&&(e=t.indexOf(navigator.platform.toLowerCase())<0),e},BoxMan.prototype.setMaxSize=function(t){var e=this.metaObj,o=document.createElement("div");o.style.display="block",o.style.position="absolute",o.style.top="-5555px",o.style.left="-5555px",o.style.width="100%",o.style.height="100%",o.style.border="0px solid",o.style.padding="0px",o.style.margin="0px",getEl(document.body).add(o);var n=o.offsetWidth,i=o.offsetHeight;e.cam.w||(e.cam.w=n,e.cam.h=i)},BoxMan.prototype.setLastPos=function(t){var e=this.metaObj;void 0!=t.touches?(e.lastPosX=t.touches[0].pageX,e.lastPosY=t.touches[0].pageY):(e.lastPosX=t.clientX+this.getBodyScrollX(),e.lastPosY=t.clientY+this.getBodyScrollY())},BoxMan.prototype.isInBox=function(t,e,o){var n=this.getBodyOffset(t),i=n.x,r=n.y;return i+t.scrollLeft<e&&i+t.offsetWidth+t.scrollLeft>e&&r+t.scrollTop<o&&r+t.offsetHeight+t.scrollTop>o},BoxMan.prototype.getBodyScrollX=function(t){var e=0;return document.documentElement&&document.documentElement.scrollLeft&&(e=document.documentElement.scrollLeft),window.pageXOffset&&(bodyPageY=window.pageXOffset),document.body&&document.body.scrollLeft&&(e=document.body.scrollLeft),e},BoxMan.prototype.getBodyScrollY=function(t){var e=0;return document.documentElement&&document.documentElement.scrollTop&&(e=document.documentElement.scrollTop),window.pageYOffset&&(e=window.pageYOffset),document.body&&document.body.scrollTop&&(e=document.body.scrollTop),e},BoxMan.prototype.getBodyOffsetX=function(t){var e=0;return document.documentElement&&document.documentElement.offsetWidth?document.documentElement.offsetWidth:document.body&&document.body.offsetWidth?document.body.offsetWidth:e},BoxMan.prototype.getBodyOffsetY=function(t){var e=0;return document.documentElement&&document.documentElement.offsetHeight?document.documentElement.offsetHeight:document.body&&document.body.offsetHeight?document.body.offsetHeight:e},BoxMan.prototype.getBodyOffset=function(t){for(var e=0,o=0,n=t,i=t.parentNode;i;){if(i!=document.body.parentNode.parentNode&&i!=document.body.parentNode.parentNode.parentNode){var r=0,a=0;if(n!=document.body&&(r=n.scrollLeft,a=n.scrollTop),"absolute"==i.style.position)e+=n.offsetLeft-r,o+=n.offsetTop-a;else{if("fixed"==i.style.position||"fixed"==n.style.position){e+=n.offsetLeft+this.getBodyScrollX(),o+=n.offsetTop+this.getBodyScrollY();break}e+=n.offsetLeft-i.offsetLeft-r,o+=n.offsetTop-i.offsetTop-a}}n=i,i=i.parentNode}var s={x:e,y:o};return s},BoxMan.prototype.setTimer=function(t){var e=this.metaObj;return function(t){e.timerTime+=100,e.timerTime>=e.timeForReadyToDrag&&(t.preventDefault(t),getEl(e.mvObj).clas.add("sj-obj-is-on-moving"),e.isOnDown=!0,e.isOnMoving=!1,clearTimeout(timer),e.timerTime=0)}},BoxMan.prototype.removeTimer=function(){var t=this.metaObj;clearTimeout(t.timer),t.timerTime=0};