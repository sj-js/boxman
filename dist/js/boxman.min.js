function BoxMan(t){var e=this;return this.objs={},this.boxObjs={},this.exBoxObjs={},this.keyboarder=new BoxManKeyboarder(this),this.afterDetectFuncList=[],this.addedEventFuncs={},this.globalSetup={modeCopy:!1,modeOnlyBoxToBox:!0,modeRemoveOutOfBox:!1,appendType:BoxMan.APPEND_TYPE_LAST},this.globalSetupForBox={},this.globalSetupForObj={},this.globalSetupForExBox={},this.metaObj={mvObj:void 0,isOnDown:!1,isOnMoving:!1,lastPosX:0,lastPosY:0,mvObjPreviewClone:void 0,mvObjPreviewOriginalClone:void 0,mvObjStartBodyOffset:void 0,mvObjCloneList:[],mvObjOriginalShelterList:[],cam:{w:window.innerWidth,h:window.innerHeight},limit:2,layerOnMove:void 0,mode:new BoxManMode(this.globalSetup)},t&&this.set(t),getEl().ready(function(){getEl().resize(function(){e.setMaxSize()}),e.setMaxSize(),e.isMobile()?(getEl(document).addEventListener("touchstart",function(t){e.whenMouseDown(t)}),getEl(document).addEventListener("touchmove",function(t){e.whenMouseMove(t)}),getEl(document).addEventListener("touchend",function(t){e.whenMouseUp(t)})):(getEl(document).addEventListener("mousedown",function(t){e.whenMouseDown(t)}),getEl(document).addEventListener("mousemove",function(t){e.whenMouseMove(t)}),getEl(document).addEventListener("mouseup",function(t){e.whenMouseUp(t)}))}),this}function BoxManBox(t){this.limit,this.acceptbox=[],this.rejectbox=[],this.acceptobj=[],this.rejectobj=[],this.conditionbox=[],this.conditionobj=[],this.beforeboxin,this.boxinout,this.start,this.boxin,this.boxout,this.mode=new BoxManMode}function BoxManObj(t){}function BoxManExBox(t){}function BoxManMode(t){this.modes={},this.set(t)}function BoxManKeyboarder(t){var e=this;this.boxMan=t,this.selectorBox,this.targetBox,this.meta={goingToBeInThisBox:null,isEventStarted:!1,keborderStatus:e.STATUS_NONE}}BoxMan.APPEND_TYPE_LAST=1,BoxMan.APPEND_TYPE_FIRST=2,BoxMan.APPEND_TYPE_BETWEEN=3,BoxMan.APPEND_TYPE_OVERWRITE=4,BoxMan.APPEND_TYPE_SWAP=5,BoxMan.APPEND_TYPE_INVISIBLE=6,BoxMan.prototype.set=function(t){for(var e in t)this.globalSetup[e]=t[e]},BoxMan.prototype.clone=function(t){var e,o=getEl(t).obj,n=o.cloneNode(!0),i={};null!=o.getAttribute("data-box")?e=this.getBoxByManId(o.manid):null!=o.getAttribute("data-obj")?e=this.getObjByManId(o.manid):null!=o.getAttribute("data-exbox")&&(e=this.getExBoxByManId(o.manid));for(var r in e)i[r]=e[r];return this.setObj(n,i),n},BoxMan.prototype.detect=function(t){var e=this;return getEl().ready(function(){var o;o=document.querySelectorAll("[data-box]");for(var n=0;n<o.length;n++)e.addBox(o[n]);o=document.querySelectorAll("[data-exbox]");for(var n=0;n<o.length;n++)e.addExBox(o[n]);o=document.querySelectorAll("[data-obj]");for(var n=0;n<o.length;n++)e.addObj(o[n]);t&&t(e);for(var i=e.afterDetectFuncList,n=0;n<i.length;n++)i[n]()}),this},BoxMan.prototype.afterDetect=function(t){var e=this;return e.afterDetectFuncList.push(t),this},BoxMan.prototype.addEventListener=function(t,e){this.addedEventFuncs[t]||(this.addedEventFuncs[t]=[]),this.addedEventFuncs[t].push(e)},BoxMan.prototype.execEvent=function(t,e){var o=this.addedEventFuncs[t];if(o)for(var n=0;n<o.length;n++)o[n](e)},BoxMan.prototype.addBox=function(t){null==t.getAttribute("data-box")&&void 0==t.getAttribute("data-box")&&t.setAttribute("data-box","");var e={limit:t.getAttribute("data-limit"),acceptbox:getData(t.getAttribute("data-accept-box")).parse(),rejectbox:getData(t.getAttribute("data-reject-box")).parse(),acceptobj:getData(t.getAttribute("data-accept-obj")).parse(),rejectobj:getData(t.getAttribute("data-reject-obj")).parse(),conditionbox:[],conditionobj:[],beforeboxin:t.getAttribute("data-event-beforeboxin"),boxinout:t.getAttribute("data-event-boxinout"),start:t.getAttribute("data-event-start"),boxin:t.getAttribute("data-event-boxin"),boxout:t.getAttribute("data-event-boxout")};this.setBox(t,e)},BoxMan.prototype.newBox=function(t){var e,o=getNewEl("div","","",{"data-box":"true"},"");return e=t.parent?"string"==typeof parent?document.getElementById(t.parent):t.parent:t.parentEl?t.parentEl:document.body,this.setBox(o,t,e),o},BoxMan.prototype.setBox=function(t,e,o){if(t=getEl(t).obj,e=e?e:{},t.isAdaptedBox)return!1;t.isAdaptedBox=!0,getEl(t).clas.add("sj-obj-box");var n=this.boxObjs,i=e.manid?e.manid:getEl(n).getNewSeqId("tmpBox");t.manid=i,this.boxObjs[i]=e,this.boxObjs[i].el=t,this.boxObjs[i].id=t.id,this.boxObjs[i].manid=i,this.boxObjs[i].mode=new BoxManMode;var r=this.globalSetupForBox,a=e?e:{};for(var s in r)a[s]||(a[s]=r[s]);return a&&(a.imgURL&&(t.style.background='url("'+a.imgURL+'")'),a.width&&a.height&&(t.style.backgroundSize=a.width+" "+a.height),a.width&&(t.style.width=a.width),a.height&&(t.style.height=a.height),a.content&&(t.innerHTML=a.content)),o&&getEl(o).add(t),a.beforeboxin&&(t.executeEventBeforeboxin=new Function("box","obj","boxsize",eventFn)),a.beforeboxinout&&(t.executeEventBoxinout=new Function("box","obj","boxSize","boxBefore",eventFn)),a.start&&(t.executeEventStart=new Function("box","obj","boxSize",eventFn),t.executeEventStart(obj,void 0,this.getMovableObjCount(obj))),a.boxin&&(t.executeEventBoxin=new Function("box","obj","boxSize","boxBefore",eventFn)),a.boxout&&(t.executeEventBoxout=new Function("box","obj","boxSize",eventFn)),i},BoxMan.prototype.delBox=function(t){var e=this.getBox(t),o=e.el,n=o.manid;return delete this.boxObjs[n],o.parentNode.removeChild(o),this},BoxMan.prototype.getBox=function(t){if("string"==typeof t)return this.getBoxById(t);if(t instanceof Element)return this.getBoxByEl(t);var e=this.getBoxesByCondition(t);return null!=e&&e.length>0?e[0]:void 0},BoxMan.prototype.getElementByBox=function(t){var e=this.getBox(t);return e.el},BoxMan.prototype.setBoxMode=function(t,e){for(var o=this.getBoxesByCondition(t),n=0;n<o.length;n++){var i=o[n];i.mode.set(e)}return this},BoxMan.prototype.getBoxById=function(t){var e=document.getElementById(t);return this.boxObjs[e.manid]},BoxMan.prototype.getBoxByEl=function(t){var e=this.boxObjs;if(t&&t.manid){var o=t.manid,n=e[o];return n}},BoxMan.prototype.getBoxByManId=function(t){return this.boxObjs[t]},BoxMan.prototype.getBoxes=function(){return this.boxObjs},BoxMan.prototype.getBoxesByCondition=function(t){var e=[],o=this.boxObjs;for(var n in o){var i=o[n],r=getEl(i).find(t);r&&e.push(r)}return e},BoxMan.prototype.getBoxesByDomAttributeCondition=function(t){var e=[],o=this.boxObjs;for(var n in o){var i=o[n],r=i.el,a=getEl(r).findDomAttribute(t);a&&e.push(a)}return e},BoxMan.prototype.clearBox=function(t){var e=getEl(t).obj;return e.innerHTML="",this},BoxMan.prototype.addAcceptBox=function(t,e){for(var o=this.getBoxesByCondition(t),n=0;n<o.length;n++){var i=o[n];void 0!=i.acceptbox&&null!=i.acceptbox||(i.acceptbox=[]),i.acceptbox instanceof Array?e instanceof Array?i.acceptbox.concat(e):i.acceptbox.push(e):i.acceptbox=[i.acceptbox]}return this},BoxMan.prototype.addRejectBox=function(t,e){for(var o=this.getBoxesByCondition(t),n=0;n<o.length;n++){var i=o[n];void 0!=i.rejectbox&&null!=i.rejectbox||(i.rejectbox=[]),i.rejectbox instanceof Array?e instanceof Array?i.rejectbox.concat(e):i.rejectbox.push(e):i.rejectbox=[i.acceptbox]}return this},BoxMan.prototype.addConditionWithBox=function(t,e,o){for(var n=this.getBoxesByCondition(t),i=0;i<n.length;i++){var r=n[i];r.conditionbox.push({condition:e,data:o})}return this},BoxMan.prototype.getConditionData=function(t,e){var o={};if(null!=e&&e.length>0)for(var n=0;n<e.length;n++){var i=e[n],r=i.condition,a=i.data;if(getEl(t).isAccepted(r))for(var s in a)o[s]=a[s]}return o},BoxMan.prototype.addAcceptObj=function(t,e){for(var o=this.getBoxesByCondition(t),n=0;n<o.length;n++){var i=o[n];void 0!=i.acceptobj&&null!=i.acceptobj||(i.acceptobj=[]),i.acceptobj instanceof Array?e instanceof Array?i.acceptobj.concat(e):i.acceptobj.push(e):i.acceptobj=[i.acceptobj]}return this},BoxMan.prototype.addRejectObj=function(t,e){for(var o=this.getBoxesByCondition(t),n=0;n<o.length;n++){var i=o[n];void 0!=i.rejectobj&&null!=i.rejectobj||(i.rejectobj=[]),i.rejectobj instanceof Array?e instanceof Array?i.rejectobj.concat(e):i.rejectobj.push(e):i.rejectobj=[i.rejectobj]}return this},BoxMan.prototype.addConditionWithObj=function(t,e,o){for(var n=this.getBoxesByCondition(t),i=0;i<n.length;i++){var r=n[i];r.conditionobj.push({condition:conditionForBox,data:o})}return this},BoxMan.prototype.suspendBox=function(t,e){var o=getEl(t).obj,n=getEl(e).obj,i=n.offsetTop+n.offsetHeight,r=n.offsetLeft;o.style.position="absolute",o.style.top=i+"px",o.style.left=r+"px"},BoxMan.prototype.addExBox=function(t){null==t.getAttribute("data-exbox")&&void 0==t.getAttribute("data-exbox")&&t.setAttribute("data-exbox","");var e={id:t.getAttribute("data-exbox-id")};this.setExBox(t,e)},BoxMan.prototype.newExBox=function(t){var e,o=getNewEl("div","","",{"data-exbox":"true"},"");return e=t.parent?"string"==typeof parent?document.getElementById(t.parent):t.parent:t.parentEl?t.parentEl:document.body,this.setExBox(o,t,e),o},BoxMan.prototype.setExBox=function(t,e,o){if(e=e?e:{},t.isAdaptedExBox)return!1;t.isAdaptedExBox=!0,getEl(t).clas.add("sj-obj-exbox");var n=this,i=this.exBoxObjs,r=e.manid?e.manid:getEl(i).getNewSeqId("tmpExBox");t.manid=r,this.exBoxObjs[r]=e,this.exBoxObjs[r].el=t,this.exBoxObjs[r].id=t.id,this.exBoxObjs[r].manid=r;var a=this.globalSetupForExBox,s=e?e:{};for(var d in a)s[d]||(s[d]=a[d]);s&&(s.imgURL&&(t.style.background='url("'+s.imgURL+'")'),s.width&&s.height&&(t.style.backgroundSize=s.width+" "+s.height),s.width&&(t.style.width=s.width),s.height&&(t.style.height=s.height),s.content&&(t.innerHTML=s.content)),o&&getEl(o).add(t),getEl(t).clas.add("sj-obj-exbox"),getEl(t).addEventListener("dragenter",n.handleDragOver(n)),getEl(t).addEventListener("dragover",n.handleDragOver(n)),getEl(t).addEventListener("dragleave",n.handleDragOut(n)),getEl(t).addEventListener("drop",n.handleDrop(n));var l=t.getAttribute("data-exbox");return null!=l&&void 0!=l&&n.addEventListener("drop",new Function("event",l)),r},BoxMan.prototype.getExBox=function(t){return"string"==typeof t?this.getExBoxById(t):this.getExBoxByEl(t)},BoxMan.prototype.getElementByExBox=function(t){var e=this.getExBox(t);return e.el},BoxMan.prototype.delExBox=function(t){var e=this.getExBox(t),o=e.el,n=o.manid;return delete this.exBoxObjs[n],o.parentNode.removeChild(o),this},BoxMan.prototype.getExBoxes=function(){return this.exBoxObjs},BoxMan.prototype.getExBoxById=function(t){var e=document.getElementById(t);return this.exBoxObjs[e.manid]},BoxMan.prototype.getExBoxByManId=function(t){return this.exBoxObjs[t]},BoxMan.prototype.getExBoxByEl=function(t){var e=this.exBoxObjs;if(t&&t.manid){var o=t.manid,e=e[o];return e}},BoxMan.prototype.handleDragOver=function(t){return function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy";var e=t.target;e.style.background="#ffdddd"}},BoxMan.prototype.handleDragOut=function(t){return function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy";var e=t.target;e.style.background=""}},BoxMan.prototype.handleDrop=function(t){return function(e){e.stopPropagation(),e.preventDefault();var o=e.originalEvent?e.originalEvent.dataTransfer.files:e.dataTransfer?e.dataTransfer.files:"";e.exbox={files:o},t.execEvent("drop",e),e.target.style.background=""}},BoxMan.prototype.addObj=function(t){var e={manid:t.getAttribute("data-obj-id")};this.setObj(t,e)},BoxMan.prototype.newObj=function(t){var e,o=getNewEl("div","","",{"data-obj":"true"},"");return e=t.parent?"string"==typeof parent?document.getElementById(t.parent):t.parent:t.parentEl?t.parentEl:document.body,this.setObj(o,t,e),o},BoxMan.prototype.setObj=function(t,e,o){if(e=e?e:{},t.isAdaptedMovable)return!1;t.isAdaptedMovable=!0,getEl(t).clas.add("sj-obj-movable");var n=this,i=this.objs,r=getEl(i).getNewSeqId("tmpObj");t.manid=r,this.objs[r]=e,this.objs[r].el=t,this.objs[r].id=t.id,this.objs[r].manid=r;var a=this.globalSetupForObj,s=e?e:{};for(var d in a)s[d]||(s[d]=a[d]);return s&&(s.imgURL&&(t.style.background='url("'+s.imgURL+'")'),s.width&&s.height&&(t.style.backgroundSize=s.width+" "+s.height),s.width&&(t.style.width=s.width),s.height&&(t.style.height=s.height),s.content&&(t.innerHTML=s.content)),t.style.left=t.offsetLeft+"px",t.style.top=t.offsetTop+"px",o&&getEl(o).add(t),this.isMobile()?getEl(t).addEventListener("touchstart",function(e){n.objStartMove(e,t)}):getEl(t).addEventListener("mousedown",function(e){n.objStartMove(e,t)}),getEl(t).addEventListener("click",function(){}),r},BoxMan.prototype.delObj=function(t){var e=this.getObj(t),o=e.el,n=o.manid;return delete this.objs[n],o.parentNode.removeChild(o),this},BoxMan.prototype.delObjByBox=function(t){for(var e=this.getBox(t),o=e.el,n=0;n<o.children.length;n++){var i=o.children[n];null!=i.getAttribute("data-obj")&&this.delObj(i)}return this},BoxMan.prototype.getObj=function(t){if("string"==typeof t)return this.getObjById(t);if(t instanceof Element)return this.getObjByEl(t);var e=this.getObjsByCondition(t);return null!=e&&e.length>0?e[0]:void 0},BoxMan.prototype.getElementByObj=function(t){var e=this.getObj(t);return e.el},BoxMan.prototype.getObjs=function(){return this.objs},BoxMan.prototype.getObjsByCondition=function(t){var e=[],o=this.objs;for(var n in o){var i=o[n],r=getEl(i).find(t);r&&e.push(r)}return e},BoxMan.prototype.getObjById=function(t){var e=document.getElementById(t);return this.objs[e.manid]},BoxMan.prototype.getObjByManId=function(t){return this.objs[t]},BoxMan.prototype.getObjByEl=function(t){var e=this.objs;if(t&&t.manid){var o=t.manid,n=e[o];return n}},BoxMan.prototype.getObjsByBox=function(t){for(var e={},o=this.getBox(t),n=o.el,i=0;i<n.children.length;i++){var r=n.children[i];if(null!=r.getAttribute("data-obj")){var a=r.manid,s=this.objs[a];e[a]=s}}return e},BoxMan.prototype.getObjListByBox=function(t){for(var e=[],o=this.getBox(t),n=o.el,i=0;i<n.children.length;i++){var r=n.children[i];if(null!=r.getAttribute("data-obj")){var a=r.manid,s=this.objs[a];e.push(s)}}return e},BoxMan.prototype.getObjAttributeListByBox=function(t){for(var e=[],o=this.getBox(t),n=o.el,i=0;i<n.children.length;i++){var r=n.children[i];if(null!=r.getAttribute("data-obj")){var a=r.manid,s=this.objs[a];e.push(s.attribute)}}return e},BoxMan.prototype.moveAllToOtherBox=function(t,e){var o=getEl(t).obj,n=getEl(e).obj,i=this.getObjsByBox(o);for(var r in i){var a=i[r].el;n.appendChild(a)}},BoxMan.prototype.shellterToBox=function(t){for(var e=this.metaObj.mvObjOriginalShelterList,o=getEl(t).obj,n=0;n<e.length;n++){var i=e[n];o.appendChild(i)}},BoxMan.prototype.hasEvent=function(t){var e=this.addedEventFuncs[t];return e&&e.length>0},BoxMan.prototype.whenMouseDown=function(t){var e=this.metaObj;return e.isOnMoving=!1,!0},BoxMan.prototype.objStartMove=function(t,e){var o,n=this.metaObj;if(navigator.userAgent.indexOf("Firefox")!=-1&&t.preventDefault(),e!=window)o=e;else{var i=getEl(t.target).getParentEl("data-obj");i&&(o=i)}n.mvObj=o;var r=this.createPreviewer(o);n.mvObjPreviewClone=r,n.mvObjCloneList.push(r);var a=this.createPreviewer(o);n.mvObjPreviewOriginalClone=a,n.mvObjOriginalShelterList=[],this.saveInfoBeforeMove(o,t)},BoxMan.prototype.whenMouseMove=function(t){var e=this.metaObj,o=e.mvObj;e.timerObj&&!this.isInBox(e.timerObj,e.lastPosX,e.lastPosY)&&this.removeTimer(),e.isOnDown&&(this.setLastPos(t),t.preventDefault(),this.setPreviewer(o,t),this.setMovingState(o))},BoxMan.prototype.whenMouseUp=function(t){var e=this.metaObj,o=e.mvObj;if(this.removeTimer(),e.isOnDown&&(getEl(o).clas.remove("sj-obj-is-on-moving"),e.isOnDown=!1),e.isOnMoving){var n=this.getDecidedBox(o,this.boxObjs,e.lastPosX,e.lastPosY);n=n?n:e.layerOnMove,this.deletePreviewer(),this.deleteOriginalClonePreviewer(),this.moveObjTo(o,n),o.style.zIndex=e.mvObjBeforeIndex,0==e.additionalStartPosLeft&&0==e.additionalStartPosTop||(o.style.left=parseInt(o.style.left)-e.additionalStartPosLeft+"px",o.style.top=parseInt(o.style.top)-e.additionalStartPosTop+"px"),o=null}},BoxMan.prototype.getDecidedBox=function(t,e,o,n){var i,r,a=[],s=0,d=0,l=0;for(var u in e){var x=e[u].el;this.isInBox(x,o,n)&&t!=x&&a.push(x)}for(var b=0;b<a.length;b++){var h=a[b].parentNode,c=0,v=!1,p=!1,B=0;for("fixed"==a[b].style.position&&(p=!0);h;){if(h==t){v=!0;break}if(!this.isInBox(h,o,n)&&h!=document.body&&h!=document.body.parentNode&&h!=document.body.parentNode.parentNode){v=!0;break}h.style&&"fixed"==h.style.position&&(p=!0),h=h.parentNode,c++,h&&h.getAttribute&&null!=h.getAttribute("data-pop")&&(B=h.popIndex)}if(!v){if(l<B)l=B,s=c,i=a[b];else if(!(l=B))continue;p?d<c&&(d=c,r=a[b]):s<c&&(s=c,i=a[b])}}return r?r:i},BoxMan.prototype.getMovableObjCount=function(t){var e=0;if(t)for(var o=0;o<t.children.length;o++){var n=t.children[o].getAttribute("data-obj");null!=n&&void 0!=n&&"false"!=n&&e++}return e},BoxMan.prototype.getMovableObj=function(t,e){var o=this.metaObj;if(t)for(var n=0;n<t.children.length;n++){var i=t.children[n],r=i.getAttribute("data-obj"),a=i.getAttribute("data-obj-previewer");if((null!=a||null!=r&&void 0!=r&&"false"!=r)&&this.isInBox(i,o.lastPosX,o.lastPosY))return i}},BoxMan.prototype.saveInfoBeforeMove=function(t,e){var o=this.metaObj;if(o.mvObjBeforeBox=t.parentNode,o.mvObjBeforeIndex=t.style.zIndex,o.mvObjBeforePosition=t.style.position,o.mvObjBeforeNextSibling=t.nextSibling,o.mvObjStartBodyOffset=getEl(t).getBoundingClientRect(),t.style.zIndex=getData().findHighestZIndex(["div"])+1,o.lastGoingToBeInThisBox=o.mvObjBeforeBox,o.mode.clear().merge(this.globalSetup).merge(this.getBox(o.mvObjBeforeBox).mode),t.parentNode!=document.body){var n=this.findAbsoluteParentEl(t),i=getEl(n).getBoundingClientRect();o.additionalStartPosLeft=i.left,o.additionalStartPosTop=i.top}else o.additionalStartPosLeft=0,o.additionalStartPosTop=0;this.setLastPos(e),void 0!=e.touches?(o.timerObj=e.touches[0].target,this.removeTimer(),o.timer=setInterval(setTimer,100),t.adjustX=e.touches[0].pageX-o.mvObjStartBodyOffset.left,t.adjustY=e.touches[0].pageY-o.mvObjStartBodyOffset.top):(t.adjustX=e.clientX-o.mvObjStartBodyOffset.left+getEl().getBodyScrollX(),t.adjustY=e.clientY-o.mvObjStartBodyOffset.top+getEl().getBodyScrollY(),getEl(t).clas.add("sj-obj-is-on-moving"),o.isOnDown=!0,o.isOnMoving=!1)},BoxMan.prototype.setMovingState=function(t){var e=this.metaObj,o=e.lastPosX,n=e.lastPosY,i=e.cam,r="px";o-t.adjustX>=1&&o-t.adjustX+t.offsetWidth<=i.w?t.style.left=o-t.adjustX+r:(o-t.adjustX<1&&(t.style.left=0+r),o-t.adjustX+t.offsetWidth>i.w&&(t.style.left=i.w-t.offsetWidth+r)),n-t.adjustY>=1&&n-t.adjustY+t.offsetHeight<=i.h?t.style.top=n-t.adjustY+r:(n-t.adjustY<1&&(t.style.top=0+r),n-t.adjustY+t.offsetHeight>i.h&&(t.style.top=i.h-t.offsetHeight+r)),t.style.position="absolute",t.style["float"]="",getEl(t).clas.add("sj-obj-is-on-moving"),getEl(document.body).add(t),e.isOnMoving||((t.adjustX>t.offsetWidth||t.adjustX<0)&&(t.adjustX=t.offsetWidth),(t.adjustY>t.offsetHeight||t.adjustY<0)&&(t.adjustY=t.offsetHeight)),e.isOnMoving=!0},BoxMan.prototype.moveObjTo=function(t,e){var o=this.metaObj,n=o.mode,i=o.mvObjBeforeBox,r=o.mvObjPreviewClone,a=(o.mvObjPreviewOriginalClone,this.getBox(i)),s=this.getBox(e),d=this.getObj(t),l=void 0!=a,u=void 0!=s,x=a==s,b=!1;if(u){var h=this.getConditionData(a,s.conditionbox),c=this.getConditionData(d,s.conditionobj);n.merge(h),n.merge(c),b=s.limit>this.getMovableObjCount(e)||void 0==s.limit}var v=n.get("appendType"),p=n.get("modeRemoveOutOfBox"),B=n.get("modeOnlyBoxToBox"),f=n.get("modeCopy"),g=v==BoxMan.APPEND_TYPE_BETWEEN,j=!g&&(x||!b),y=g&&!b&&!x,m=u&&e.executeEventBeforeboxin&&!e.executeEventBeforeboxin(e,t,this.getMovableObjCount(i)),E=p&&!u&&!x,O=B&&!u&&l,M=!u||getEl(a).isAccepted(s.acceptbox,s.rejectbox),P=!u||getEl(d).isAccepted(s.acceptobj,s.rejectobj),T=!1,A=!1,S=!1;if(j||m||O||!M||!P){if(E&&!u)return void this.delObj(t);this.backToBefore(t,i,v)}else if(e){if(y)return void this.backToBefore(t,i,v);var w;if(f&&v!=BoxMan.APPEND_TYPE_SWAP&&!x){var C=this.clone(t);w=C,this.backToBefore(t,i,v)}else w=t;v!=BoxMan.APPEND_TYPE_OVERWRITE||x?v==BoxMan.APPEND_TYPE_SWAP&&!x&&b&&this.shellterToBox(i):this.clearBox(e),this.goTo(w,e,v,r),T=!0,A=!0,S=!0}else o.mvObjBeforeBox.appendChild(t);if(T||!O&&u){var I=this.getMovableObjCount(i);i.executeEventMustDo&&i.executeEventMustDo(),i.executeEventBoxinout&&i.executeEventBoxinout(i,t,I),i.executeEventBoxout&&i.executeEventBoxout(i,t,I)}if(A){var N=this.getMovableObjCount(e);e.executeEventMustDo&&e.executeEventMustDo(),e.executeEventBoxinout&&e.executeEventBoxinout(e,t,N,i),e.executeEventBoxin&&e.executeEventBoxin(e,t,N,i)}return t=null,S},BoxMan.prototype.goTo=function(t,e,o,n){if(o==BoxMan.APPEND_TYPE_LAST)e.appendChild(t);else if(o==BoxMan.APPEND_TYPE_FIRST)e.insertBefore(t,e.firstChild);else if(o==BoxMan.APPEND_TYPE_BETWEEN){var i=this.getMovableObj(e,event);i?i==n.nextSibling?e.insertBefore(t,i.nextSibling):i!=n&&e.insertBefore(t,i):e.appendChild(t)}else o==BoxMan.APPEND_TYPE_OVERWRITE?e.appendChild(t):o==BoxMan.APPEND_TYPE_SWAP?e.appendChild(t):o==BoxMan.APPEND_TYPE_INVISIBLE;t.style.position=""},BoxMan.prototype.backToBefore=function(t,e,o,n){if(!n||o==BoxMan.APPEND_TYPE_SWAP){var i=this.metaObj,r=i.mvObjBeforeNextSibling,a=i.mvObjBeforePosition,s=i.mvObjStartBodyOffset;e.insertBefore(t,r),t.style.position="absolute"==a?"absolute":"","absolute"==a&&(t.style.left=s.x+"px",t.style.top=s.y+"px",t.style["float"]="")}},BoxMan.prototype.originalCopyBackToBefore=function(t,e,o,n){if(n&&o!=BoxMan.APPEND_TYPE_SWAP){if(t.parentNode!=e){if(!n||o==BoxMan.APPEND_TYPE_SWAP)return;var i=this.metaObj,r=i.mvObjBeforeNextSibling,a=i.mvObjBeforePosition,s=i.mvObjStartBodyOffset;e.insertBefore(t,r),t.style.position="absolute"==a?"absolute":"","absolute"==a&&(t.style.left=s.x+"px",t.style.top=s.y+"px",t.style["float"]="")}}else t.parentNode&&t.parentNode.removeChild(t)},BoxMan.prototype.createPreviewer=function(t){var e=(this.metaObj,t.cloneNode(!0));return e.setAttribute("data-obj","false"),e.setAttribute("data-obj-previewer","true"),getEl(e).clas.add("sj-preview-going-to-be-in-box"),e.style.position="",e},BoxMan.prototype.setPreviewer=function(t,e){var o=this.metaObj,n=o.mode.clone(),i=o.lastGoingToBeInThisBox,r=o.mvObjPreviewClone,a=o.mvObjPreviewOriginalClone,s=o.mvObjBeforeBox,d=this.getDecidedBox(t,this.boxObjs,o.lastPosX,o.lastPosY),l=d,u=this.getBox(s),x=this.getBox(l),b=this.getObj(t),h=void 0!=u,c=void 0!=x,v=u==x,p=!1;if(c){var B=this.getConditionData(u,x.conditionbox),f=this.getConditionData(b,x.conditionobj);n.merge(B),n.merge(f),p=x.limit>this.getMovableObjCount(l)||void 0==x.limit}var g=n.get("appendType"),j=n.get("modeRemoveOutOfBox"),y=n.get("modeOnlyBoxToBox"),m=n.get("modeCopy"),E=g==BoxMan.APPEND_TYPE_BETWEEN,O=!E&&(v||!p),M=E&&!p&&!v,P=(c&&l.executeEventBeforeboxin&&!l.executeEventBeforeboxin(l,t,this.getMovableObjCount(s)),!E&&y&&!c&&h),T=!c||getEl(u).isAccepted(x.acceptbox,x.rejectbox),A=!c||getEl(b).isAccepted(x.acceptobj,x.rejectobj);if(O||P||!T||!A){if(j&&!v&&!c)return r.parentNode&&r.parentNode.removeChild(r),this.originalCopyBackToBefore(a,s,g,m),this.overWriteAndSwapPreview(d,g),void(o.lastGoingToBeInThisBox=d);if(!T||!A)return o.lastGoingToBeInThisBox=d,this.originalCopyBackToBefore(a,s,g,m),void this.backToBefore(r,s,g,m);this.originalCopyBackToBefore(a,s,g,m),this.overWriteAndSwapPreview(d,g),o.lastGoingToBeInThisBox=d,this.backToBefore(r,s,g,m)}else if(l){if(M)return this.backToBefore(r,s,g,m),void(o.lastGoingToBeInThisBox=d);this.originalCopyBackToBefore(a,s,g,m),g!=BoxMan.APPEND_TYPE_OVERWRITE||v?g==BoxMan.APPEND_TYPE_SWAP&&!v&&p&&this.overWriteAndSwapPreview(d,g):(m&&r.parentNode&&r.parentNode.removeChild(r),this.overWriteAndSwapPreview(d,g)),this.goTo(r,d,g,r)}else i&&getEl(i).clas.remove("sj-tree-box-to-go"),r.parentNode&&r.parentNode.removeChild(r),this.overWriteAndSwapPreview(d,g);o.lastGoingToBeInThisBox=d},BoxMan.prototype.deletePreviewer=function(){var t=this.metaObj,e=t.mvObjPreviewClone,o=t.mvObjCloneList;e&&e.parentNode&&(e.parentNode.removeChild(e),e=void 0);for(var n=0;n<o.length;n++)o[n].parentNode&&o[n].parentNode.removeChild(o[n]);o.length>10&&(t.mvObjCloneList=[])},BoxMan.prototype.deleteOriginalClonePreviewer=function(){var t=this.metaObj,e=t.mvObjPreviewOriginalClone;e.parentNode&&e.parentNode.removeChild(e)},BoxMan.prototype.overWriteAndSwapPreview=function(t,e){var o=this.metaObj;if(o.lastGoingToBeInThisBox!=t){for(var n=0;n<o.mvObjOriginalShelterList.length;n++){var i=o.mvObjOriginalShelterList[n];o.mvObjOriginalBox.appendChild(i)}if(this.deletePreviewer(),t){o.mvObjOriginalBox=t,o.mvObjOriginalShelterList=[];var r=this.getObjsByBox(t);if(r){for(var a in r){var s=r[a];if(s){var d=s.el;o.mvObjOriginalShelterList.push(d)}}if(this.clearBox(t),e==BoxMan.APPEND_TYPE_SWAP)for(var n=0;n<o.mvObjOriginalShelterList.length;n++){var i=o.mvObjOriginalShelterList[n],l=this.createPreviewer(i);o.mvObjCloneList.push(l),o.mvObjBeforeBox.appendChild(l)}}}}},BoxMan.prototype.isMobile=function(){var t="win16|win32|win64|mac",e=!1;return navigator.platform&&(e=t.indexOf(navigator.platform.toLowerCase())<0),e},BoxMan.prototype.setMaxSize=function(t){var e=this.metaObj,o=document.createElement("div");o.style.display="block",o.style.position="absolute",o.style.top="-7777px",o.style.left="-7777px",o.style.width="100%",o.style.height="100%",o.style.border="0px solid",o.style.padding="0px",o.style.margin="0px",getEl(document.body).add(o);var n=o.offsetWidth,i=o.offsetHeight;e.cam.w=n,e.cam.h=i},BoxMan.prototype.setLastPos=function(t){var e=this.metaObj;void 0!=t.touches?(e.lastPosX=t.touches[0].pageX,e.lastPosY=t.touches[0].pageY):(e.lastPosX=t.clientX+getEl().getBodyScrollX(),e.lastPosY=t.clientY+getEl().getBodyScrollY())},BoxMan.prototype.isInBox=function(t,e,o){var n=getEl(t).getBoundingClientRect(),i=n.left,r=n.top;return i+t.scrollLeft<e&&i+t.offsetWidth+t.scrollLeft>e&&r+t.scrollTop<o+t.scrollTop&&r+t.offsetHeight+t.scrollTop>o+t.scrollTop},BoxMan.prototype.setTimer=function(t){var e=this.metaObj;return function(t){e.timerTime+=100,e.timerTime>=e.timeForReadyToDrag&&(t.preventDefault(t),getEl(e.mvObj).clas.add("sj-obj-is-on-moving"),e.isOnDown=!0,e.isOnMoving=!1,clearTimeout(timer),e.timerTime=0)}},BoxMan.prototype.removeTimer=function(){var t=this.metaObj;clearTimeout(t.timer),t.timerTime=0},BoxMan.prototype.findAbsoluteParentEl=function(t){for(var e=t.parentNode;e&&(!e.style||!e.style.position||"absolute"!=e.style.position);)e=e.parentNode;return e?e:document.body},BoxMan.prototype.getKeyboarder=function(){return this.keyboarder},BoxManMode.prototype={set:function(t){if(t instanceof Object)for(var e in t)this.modes[e]=t[e];else"string"==typeof t&&(this.modes[t]=!0);return this},get:function(t){return this.modes[t]},del:function(t){return delete this.modes[t],this},toggle:function(t){var e=this.modes[t];return void 0!=this.modes[t]&&null!=this.modes[t]&&"boolean"==typeof e&&(this.modes[t]=!e),this},clear:function(){return this.modes={},this},clone:function(){return new BoxManMode(this.modes)},merge:function(t){if(t instanceof BoxManMode){var e=t.modes;for(var o in e)this.modes[o]=e[o]}else this.set(t);return this}},BoxManKeyboarder.prototype={STATUS_NONE:0,STATUS_MOVE:1,STATUS_DROP:2,setSelectorBox:function(t){var e=this,o=this.meta;this.delSelectorBox();var t=this.boxMan.getBox(t),n=t.el;this.selectorBox=t,n.setAttribute("data-status","selected"),o.isEventStarted||(o.isEventStarted=!0,getEl(document).addEventListener("keydown",function(t){null!=e.selectorBox&&void 0!=e.selectorBox&&(38==t.keyCode&&e.selectPrevObjInBox(e.selectorBox.el),40==t.keyCode&&e.selectNextObjInBox(e.selectorBox.el),17==t.keyCode&&e.handleKeyborderControler(e.selectorBox.el))}))},delSelectorBox:function(t){var e;if(e=null!=t&&""!=t?this.boxMan.getBox(t):this.selectorBox,null!=e&&void 0!=e){var o=e.el;if(null!=o&&void 0!=o&&"selected"==o.getAttribute("data-status")){o.removeAttribute("data-status"),this.selectorBox=void 0;var n=this.getSelectedObjInBox(o);n&&n.el&&n.el.removeAttribute("data-status")}}},setTargetBox:function(t){},handleKeyborderControler:function(t){this.keborderStatus==this.STATUS_NONE?this.keborderStatus=this.STATUS_MOVE:this.keborderStatus==this.STATUS_MOVE&&(this.keborderStatus=this.STATUS_DROP,this.keborderStatus=this.STATUS_NONE)},selectNextObjInBox:function(t){var e=this.getSelectedObjIndexInBox(t);return this.deselectObjAllInBox(t),this.selectObjInBoxByIndex(t,e+1),this},selectPrevObjInBox:function(t){var e=this.getSelectedObjIndexInBox(t);return this.deselectObjAllInBox(t),this.selectObjInBoxByIndex(t,e-1),this},deselectObjAllInBox:function(t){for(var e=this.boxMan.getBox(t),o=e.el,n=0;n<o.children.length;n++){var i=o.children[n];null!=i.getAttribute("data-obj")&&null!=i.getAttribute("data-status")&&i.removeAttribute("data-status")}return this},selectObjInBoxByIndex:function(t,e){var o=this.boxMan.getBox(t),n=o.el,i=n.children.length,r=-1;e=e>0?e:0,e=e<i?e:i-1;for(var a=0;a<n.children.length;a++){var s=n.children[a];if(null!=s.getAttribute("data-obj")&&++r==e){s.setAttribute("data-status","selected");break}}return this},getSelectedObjInBox:function(t){for(var e,o=this.boxMan.getBox(t),n=o.el,i=-1,r=0;r<n.children.length;r++){var a=n.children[r];if(null!=a.getAttribute("data-obj")&&(i++,null!=a.getAttribute("data-status"))){e=a;break}}return this.boxMan.getObj(e)},getSelectedObjIndexInBox:function(t){for(var e=this.boxMan.getBox(t),o=e.el,n=-1,i=n,r=0;r<o.children.length;r++){var a=o.children[r];if(null!=a.getAttribute("data-obj")&&(n++,null!=a.getAttribute("data-status"))){i=n;break}}return i}};