function e(e){var t=this;this.addedEventFuncs={},this.objs={},this.boxObjs={},this.metaObj={mvObj:void 0,isOnDown:!1,isOnMoving:!1,lastPosX:0,lastPosY:0,mvObjPreviewClone:void 0,mvObjStartBodyOffset:void 0,mvObjCloneList:[],cam:{w:window.innerWidth,h:window.innerHeight},isCopy:!0,isOverwrite:!1,appendType:this.APPEND_TYPE_PUSH},window.addEventListener("load",function(e){t.setMaxSize(),t.isMobile()?(getEl(document).addEventListener("touchstart",function(e){t.whenMouseDown(e)}),getEl(document).addEventListener("touchmove",function(e){t.whenMouseMove(e)}),getEl(document).addEventListener("touchend",function(e){t.whenMouseUp(e)})):(getEl(document).addEventListener("mousedown",function(e){t.whenMouseDown(e)}),getEl(document).addEventListener("mousemove",function(e){t.whenMouseMove(e)}),getEl(document).addEventListener("mouseup",function(e){t.whenMouseUp(e)}),window.addEventListener("resize",function(e){t.whenResize(e)}))})}window.getNewEl=function(e,t,o,n,i,r,s){var a=document.createElement(e);t&&(a.id=t),o&&a.setAttribute("class",o);for(var d in n)a.setAttribute(d,n[d]);return i&&(a.innerHTML=i),r&&getEl(a).addEventListener(r,function(e){s(e)}),a},window.getEl=function(e){var t="object"==typeof e?e:document.getElementById(e);return this.obj=t,this.attr=function(e,o){return o?(t.setAttribute(e,o),this):t.getAttribute(e)},this.clas=function(){var e={has:function(e){return t.className.indexOf(e)!=-1},add:function(o){return t.classList?t.classList.add(o):t.className+=" "+o+" ",e},remove:function(o){if(t.classList)t.classList.remove(o);else{for(var n=t.className.split(" ");n.indexOf(o)!=-1;)n.splice(n.indexOf(o),1);t.className=n.join(" ")}return e}};return e}(),this.findEl=function(e,o){for(var n=t.children,i=0;i<n.length;i++)if(n[i].getAttribute(e)==o)return n[i]},this.findParentEl=function(e,o){for(var n,i=t;i;){if(i==document.body.parentNode){n=null;break}if(i.getAttribute(e)==o){n=i;break}i=i.parentNode}return n},this.add=function(e){return"object"==typeof e?t.appendChild(e):t.innerHTML+=e,this},this.addln=function(e){return"object"==typeof e?t.appendChild(e):t.innerHTML+=e?e:"",t.appendChild(document.createElement("br")),this},this.hasEventListener=function(e){return t.hasEventListener(e)},this.removeEventListener=function(e,o){return t.removeEventListener(e,o),this},this.addEventListener=function(e,o){navigator.userAgent.indexOf("Firefox")!=-1&&t.addEventListener(e,function(e){window.event=e},!0),t.addEventListener?t.addEventListener(e,function(e){o(e)}):t.attachEvent("on"+e,function(e){!e.target&&e.srcElement&&(e.target=e.srcElement),o(e)})},this.del=function(e){return t.removeChild(e),this},this.html=function(e){return t.innerHTML=e,this},this.clear=function(){return t.innerHTML="",this},this.scrollDown=function(){return t.scrollTop=t.scrollHeight,this},this.disableSelection=function(){return"undefined"!=typeof t.ondragstart&&(t.ondragstart=function(){return!1}),"undefined"!=typeof t.onselectstart&&(t.onselectstart=function(){return!1}),"undefined"!=typeof t.oncontextmenu&&(t.oncontextmenu=function(){return!1}),"undefined"!=typeof t.style.MozUserSelect&&(document.body.style.MozUserSelect="none"),this},this.hideDiv=function(){return t.style.display="block",t.style.position="absolute",t.style.left="-5555px",t.style.top="-5555px",this},this.showDiv=function(){return t.style.display="block",t.style.position="absolute",t.style.left="0px",t.style.top="0px",this},this.getNewSeqId=function(e){for(var o=1;o<5e4;o++){var n=e+o;if(!(n in t))return n}return null},this.getParentEl=function(e){for(var o=t;o&&void 0==o.getAttribute(e);)o=o.parentNode;return o},this},function(){for(var e=0,t=["ms","moz","webkit","o"],o=0;o<t.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[t[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[o]+"CancelAnimationFrame"]||window[t[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,o){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),r=window.setTimeout(function(){t(n+i)},i);return e=n+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder}(),function(){navigator.userAgent.indexOf("Firefox")!=-1&&window.addEventListener(eventNm,function(e){window.event=e},!0),!window.addEventListener&&window.attachEvent&&(window.addEventListener=function(e,t){window.attachEvent("on"+e,function(e){!e.target&&e.srcElement&&(e.target=e.srcElement),e.preventDefault||(e.preventDefault=function(){}),e.stopPropagation||(e.stopPropagation=function(){e.returnValue=!1,e.cancelBubble=!0}),t(e)})})}(),function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1})}(),function(){document.querySelectorAll||document.getElementsByTagName&&(document.querySelectorAll=function(){var e,t=selector.indexOf("["),o=selector.indexOf("]"),n=[];if(t!=-1&&o!=-1){e=selector.substring(t+1,o);for(var i=["div","span","form","input","select","textarea"],r=0;r<i.length;r++)for(var s=document.getElementsByTagName(i[r]),a=0;a<s.length;a++)void 0!=s[a].getAttribute(e)&&n.push(s[a])}return n})}(),e.prototype.APPEND_TYPE_LAST=1,e.prototype.APPEND_TYPE_FIRST=2,e.prototype.APPEND_TYPE_PUSH=3,e.prototype.detect=function(){var e;e=document.querySelectorAll("[data-box]");for(var t=0;t<e.length;t++)this.addBox(e[t]);e=document.querySelectorAll("[data-movable]");for(var t=0;t<e.length;t++)this.addObj(e[t])},e.prototype.addEventListener=function(e,t){this.addedEventFuncs[e]||(this.addedEventFuncs[e]=[]),this.addedEventFuncs[e].push(t)},e.prototype.execEvent=function(e,t){var o=this.addedEventFuncs[e];if(o)for(var n=0;n<o.length;n++)o[n](t)},e.prototype.addBox=function(e){this.setBox("",e)},e.prototype.newBox=function(e,t){var o=e?e:{};t=t?t:document.body;var n=getNewEl("div","","",{"data-box":"true"},"");return o&&(o.imgURL&&(n.style.background='url("'+o.imgURL+'")'),o.width&&o.height&&(n.style.backgroundSize=o.width+" "+o.height),o.width&&(n.style.width=o.width),o.height&&(n.style.height=o.height),o.content&&(n.innerHTML=o.content)),this.setBox("",n,e,t)},e.prototype.setBox=function(e,t,o,n){if(t.isAdaptedBox)return!1;t.isAdaptedBox=!0,getEl(t).clas.add("sj-obj-box");var i=this.boxObjs;e=e?e:getEl(i).getNewSeqId("tmp"),this.boxObjs[e]={el:t,info:o?o:{}},n&&getEl(n).add(t),null==t.getAttribute("data-box")&&void 0==t.getAttribute("data-box")&&t.setAttribute("data-box","");var r=t.getAttribute("data-event-beforeboxin");null!=r&&void 0!=r&&(t.executeEventBeforeboxin=new Function("box","obj","boxsize",r));var r=t.getAttribute("data-event-boxinout");null!=r&&void 0!=r&&(t.executeEventBoxinout=new Function("box","obj","boxSize","boxBefore",r));var r=t.getAttribute("data-event-start");null!=r&&void 0!=r&&(t.executeEventStart=new Function("box","obj","boxSize",r),t.executeEventStart(obj,void 0,this.getMovableObjCount(obj)));var r=t.getAttribute("data-event-boxin");null!=r&&void 0!=r&&(t.executeEventBoxin=new Function("box","obj","boxSize","boxBefore",r));var r=t.getAttribute("data-event-boxout");return null!=r&&void 0!=r&&(t.executeEventBoxout=new Function("box","obj","boxSize",r)),e},e.prototype.getBox=function(e){return this.boxObjs[e]},e.prototype.addObj=function(e){this.setObj("",e)},e.prototype.newObj=function(e,t){var o=e?e:{},n=getNewEl("div","","",{"data-movable":"true"},"");return o&&(o.imgURL&&(n.style.background='url("'+o.imgURL+'")'),o.width&&o.height&&(n.style.backgroundSize=o.width+" "+o.height),o.width&&(n.style.width=o.width),o.height&&(n.style.height=o.height),o.content&&(n.innerHTML=o.content)),t||(t=document.body),this.setObj("",n,e,t)},e.prototype.setObj=function(e,t,o,n){if(t.isAdaptedMovable)return!1;t.isAdaptedMovable=!0,getEl(t).clas.add("sj-obj-movable");var i=this,r=this.objs;return e=e?e:getEl(r).getNewSeqId("tmp"),this.objs[e]={el:t,info:o?o:{}},this.isMobile()?getEl(t).addEventListener("touchstart",function(e){i.objStartMove(e,t)}):getEl(t).addEventListener("mousedown",function(e){i.objStartMove(e,t)}),getEl(t).addEventListener("click",function(){}),t.style.left=t.offsetLeft+"px",t.style.top=t.offsetTop+"px",n&&getEl(n).add(t),e},e.prototype.getObj=function(e){return this.objs[e]},e.prototype.hasEvent=function(e){var t=this.addedEventFuncs[e];return t&&t.length>0},e.prototype.whenMouseDown=function(e){var t=this.metaObj;return t.isOnMoving=!1,!0},e.prototype.objStartMove=function(e,t){var o,n=this.metaObj;if(navigator.userAgent.indexOf("Firefox")!=-1&&e.preventDefault(),t!=window)o=t;else{var i=getEl(e.target).getParentEl("data-movable");i&&(o=i)}n.mvObj=o,this.createPreviewer(o),this.saveInfoBeforeMove(o,e)},e.prototype.whenMouseMove=function(e){var t=this.metaObj,o=t.mvObj;this.setLastPos(e),t.timerObj&&!this.isInBox(t.timerObj,t.lastPosX,t.lastPosY)&&this.removeTimer(),t.isOnDown&&(e.preventDefault(),this.setPreviewer(o,e),this.setMovingState(o))},e.prototype.whenMouseUp=function(e){var t=this.metaObj,o=t.mvObjBeforeBox,n=t.mvObj;if(this.removeTimer(),t.isOnDown&&(getEl(n).clas.remove("sj-obj-is-on-moving"),t.isOnDown=!1),t.isOnMoving){var i=this.getDecidedBox(n,this.boxObjs,t.lastPosX,t.lastPosY);if(this.deletePreviewer(),void 0!=i)return void this.moveObjTo(n,i);var r=this.getMovableObjCount(o);o.executeEventMustDo&&o.executeEventMustDo(),o.executeEventBoxinout&&o.executeEventBoxinout(o,n,r),o.executeEventBoxout&&o.executeEventBoxout(o,n,r),n=null}},e.prototype.getDecidedBox=function(e,t,o,n){var i,r,s=[],a=0,d=0;for(var u in t){var l=t[u].el;this.isInBox(l,o,n)&&e!=l&&s.push(l)}for(var c=0;c<s.length;c++){var f=s[c].parentNode,v=0,b=!1,h=!1;for("fixed"==s[c].style.position&&(h=!0);f;){if(f==e){b=!0;break}if(!this.isInBox(f,o,n)&&f!=document.body&&f!=document.body.parentNode&&f!=document.body.parentNode.parentNode){b=!0;break}f.style&&"fixed"==f.style.position&&(h=!0),f=f.parentNode,v++}b||(h?d<v&&(d=v,r=s[c]):a<v&&(a=v,i=s[c]))}return r?r:i},e.prototype.getMovableObjCount=function(e){var t=0;if(e)for(var o=0;o<e.children.length;o++){var n=e.children[o].getAttribute("data-movable");null!=n&&void 0!=n&&"false"!=n&&t++}return t},e.prototype.getMovableObj=function(e,t){if(e)for(var o=0;o<e.children.length;o++){var n=e.children[o],i=n.getAttribute("data-movable"),r=n.getAttribute("data-movable-previewer");if(null!=r||null!=i&&void 0!=i&&"false"!=i){var s=(this.getBodyOffset(n),this.metaObj);if(this.isInBox(n,s.lastPosX,s.lastPosY))return n}}},e.prototype.saveInfoBeforeMove=function(e,t){var o=this.metaObj;o.mvObjBeforeBox=e.parentNode,o.mvObjBeforePosition=e.style.position,o.mvObjBeforeNextSibling=e.nextSibling,o.mvObjStartBodyOffset=this.getBodyOffset(e),this.setLastPos(t),void 0!=t.touches?(o.timerObj=t.touches[0].target,this.removeTimer(),o.timer=setInterval(setTimer,100),e.adjustX=t.touches[0].pageX-o.mvObjStartBodyOffset.x,e.adjustY=t.touches[0].pageY-o.mvObjStartBodyOffset.y):(e.adjustX=t.clientX-o.mvObjStartBodyOffset.x+this.getBodyScrollX(),e.adjustY=t.clientY-o.mvObjStartBodyOffset.y+this.getBodyScrollY(),getEl(e).clas.add("sj-obj-is-on-moving"),o.isOnDown=!0,o.isOnMoving=!1)},e.prototype.setMovingState=function(e){var t=this.metaObj,o=t.lastPosX,n=t.lastPosY,i=t.cam,r="px";o-e.adjustX>=1&&o-e.adjustX+e.offsetWidth<=i.w?e.style.left=o-e.adjustX+r:(o-e.adjustX<1&&(e.style.left=0+r),o-e.adjustX+e.offsetWidth>i.w&&(e.style.left=i.w-e.offsetWidth+r)),n-e.adjustY>=1&&n-e.adjustY+e.offsetHeight<=i.h?e.style.top=n-e.adjustY+r:(n-e.adjustY<1&&(e.style.top=0+r),n-e.adjustY+e.offsetHeight>i.h&&(e.style.top=i.h-e.offsetHeight+r)),e.style.position="absolute",e.style["float"]="",getEl(e).clas.add("sj-obj-is-on-moving"),document.body.appendChild(e),t.isOnMoving||((e.adjustX>e.offsetWidth||e.adjustX<0)&&(e.adjustX=e.offsetWidth),(e.adjustY>e.offsetHeight||e.adjustY<0)&&(e.adjustY=e.offsetHeight)),t.isOnMoving=!0},e.prototype.moveObjTo=function(e,t){var o=this.metaObj,n=o.mvObjBeforeBox,i=(o.mvObjBeforeNextSibling,o.mvObjBeforePosition,o.mvObjStartBodyOffset,o.mvObjPreviewClone),r=""==t.getAttribute("data-box"),s=t.getAttribute("data-box")>this.getMovableObjCount(t),a=void 0!=t.getAttribute("data-tree-type"),d=t==n,u=o.appendType==this.APPEND_TYPE_PUSH,l=d||!r&&!s,c=a,f=t.executeEventBeforeboxin&&!t.executeEventBeforeboxin(t,e,this.getMovableObjCount(n)),v=!1;if(u||!l&&!f)if(c){if(getEl(t).clas.remove("sj-tree-box-to-go"),t.executeEventDrop){targetTree=sj.treeMan.get(t.sjid),targetTree.repository[e.sjid]=sj.objMan.get(e.sjid),e.parentNode.removeChild(e);var b={mvObj:e,obj:sj.objMan.get(e.sjid),decidedBox:t,treeObj:targetTree,mvObjBeforeBox:n,path:sj.treeMan.getPath(t.sjid)};t.executeEventDrop(event,b)}}else{var h;if(o.isOverwrite&&!d&&(t.innerHTML=""),o.isCopy&&!d){var p=e.cloneNode(!0);this.setObj("",p),h=p,this.backToBefore(e,n,o.appendType)}else h=e;this.runMoving(h,t,o.appendType,i),v=!0;var m=this.getMovableObjCount(t),g=this.getMovableObjCount(n);n.executeEventMustDo&&n.executeEventMustDo(),n.executeEventBoxinout&&n.executeEventBoxinout(n,e,g),n.executeEventBoxout&&n.executeEventBoxout(n,e,g),t.executeEventMustDo&&t.executeEventMustDo(),t.executeEventBoxinout&&t.executeEventBoxinout(t,e,m,n),t.executeEventBoxin&&t.executeEventBoxin(t,e,m,n)}else this.backToBefore(e,n,o.appendType);return e=null,v},e.prototype.runMoving=function(e,t,o,n){if(o==this.APPEND_TYPE_LAST)t.appendChild(e);else if(o==this.APPEND_TYPE_FIRST)t.insertBefore(e,t.firstChild);else if(o==this.APPEND_TYPE_PUSH){var i=this.getMovableObj(t,event);i?i==n.nextSibling?t.insertBefore(e,i.nextSibling):i!=n&&t.insertBefore(e,i):t.appendChild(e)}e.style.position=""},e.prototype.backToBefore=function(e,t,o){var n=this.metaObj,i=n.mvObjBeforeNextSibling,r=n.mvObjBeforePosition,s=n.mvObjStartBodyOffset;t.insertBefore(e,i),e.style.position="absolute"==r?"absolute":"","absolute"==r&&(e.style.left=s.x+"px",e.style.top=s.y+"px",e.style["float"]="")},e.prototype.createPreviewer=function(e){var t=this.metaObj,o=e.cloneNode(!0);o.setAttribute("data-movable","false"),o.setAttribute("data-movable-previewer","true"),getEl(o).clas.add("sj-preview-going-to-be-in-box"),o.style.position="",t.mvObjPreviewClone=o,t.mvObjCloneList.push(o)},e.prototype.setPreviewer=function(e,t){var o,n,i,r=this.metaObj,s=r.lastGoingToBeInThisBox,a=r.mvObjPreviewClone,d=r.mvObjBeforeBox,u=this.getDecidedBox(e,this.boxObjs,r.lastPosX,r.lastPosY),l=u==d,c=r.appendType==this.APPEND_TYPE_PUSH;void 0!=u&&(o=""==u.getAttribute("data-box"),n=u.getAttribute("data-box")>this.getMovableObjCount(u),i=void 0!=u.getAttribute("data-tree-type")),void 0==u?(s&&getEl(s).clas.remove("sj-tree-box-to-go"),a.parentNode&&a.parentNode.removeChild(a)):i?(s&&getEl(s).clas.remove("sj-tree-box-to-go"),getEl(u).clas.add("sj-tree-box-to-go"),r.lastGoingToBeInThisBox=u):c||!l&&(o||n)?(this.runMoving(a,u,r.appendType,a),r.lastGoingToBeInThisBox=u):(this.backToBefore(a,d,r.appendType),r.lastGoingToBeInThisBox=u)},e.prototype.deletePreviewer=function(){var e=this.metaObj,t=e.mvObjPreviewClone,o=e.mvObjCloneList;t&&t.parentNode&&(t.parentNode.removeChild(t),t=void 0);for(var n=0;n<o.length;n++)o[n].parentNode&&o[n].parentNode.removeChild(o[n]);o.length>3&&(o=[])},e.prototype.isMobile=function(){var e="win16|win32|win64|mac",t=!1;return navigator.platform&&(t=e.indexOf(navigator.platform.toLowerCase())<0),t},e.prototype.setMaxSize=function(e){var t=this.metaObj,o=document.createElement("div");o.style.display="block",o.style.position="absolute",o.style.top="-5555px",o.style.left="-5555px",o.style.width="100%",o.style.height="100%",o.style.border="0px solid",o.style.padding="0px",o.style.margin="0px",getEl(document.body).add(o);var n=o.offsetWidth,i=o.offsetHeight;t.cam.w||(t.cam.w=n,t.cam.h=i)},e.prototype.setLastPos=function(e){var t=this.metaObj;void 0!=e.touches?(t.lastPosX=e.touches[0].pageX,t.lastPosY=e.touches[0].pageY):(t.lastPosX=e.clientX+this.getBodyScrollX(),t.lastPosY=e.clientY+this.getBodyScrollY())},e.prototype.isInBox=function(e,t,o){var n=this.getBodyOffset(e),i=n.x,r=n.y;return i+e.scrollLeft<t&&i+e.offsetWidth+e.scrollLeft>t&&r+e.scrollTop<o&&r+e.offsetHeight+e.scrollTop>o},e.prototype.getBodyScrollX=function(e){var t=0;return document.documentElement&&document.documentElement.scrollLeft&&(t=document.documentElement.scrollLeft),window.pageXOffset&&(bodyPageY=window.pageXOffset),document.body&&document.body.scrollLeft&&(t=document.body.scrollLeft),t},e.prototype.getBodyScrollY=function(e){var t=0;return document.documentElement&&document.documentElement.scrollTop&&(t=document.documentElement.scrollTop),window.pageYOffset&&(t=window.pageYOffset),document.body&&document.body.scrollTop&&(t=document.body.scrollTop),t},e.prototype.getBodyOffsetX=function(e){var t=0;return document.documentElement&&document.documentElement.offsetWidth?document.documentElement.offsetWidth:document.body&&document.body.offsetWidth?document.body.offsetWidth:t},e.prototype.getBodyOffsetY=function(e){var t=0;return document.documentElement&&document.documentElement.offsetHeight?document.documentElement.offsetHeight:document.body&&document.body.offsetHeight?document.body.offsetHeight:t},e.prototype.getBodyOffset=function(e){for(var t=0,o=0,n=e,i=e.parentNode;i;){if(i!=document.body.parentNode.parentNode&&i!=document.body.parentNode.parentNode.parentNode){var r=0,s=0;if(n!=document.body&&(r=n.scrollLeft,s=n.scrollTop),"absolute"==i.style.position)t+=n.offsetLeft-r,o+=n.offsetTop-s;else{if("fixed"==i.style.position||"fixed"==n.style.position){t+=n.offsetLeft+this.getBodyScrollX(),o+=n.offsetTop+this.getBodyScrollY();break}t+=n.offsetLeft-i.offsetLeft-r,o+=n.offsetTop-i.offsetTop-s}}n=i,i=i.parentNode}var a={x:t,y:o};return a},e.prototype.setTimer=function(e){var t=this.metaObj;return function(e){t.timerTime+=100,t.timerTime>=t.timeForReadyToDrag&&(e.preventDefault(e),getEl(t.mvObj).clas.add("sj-obj-is-on-moving"),t.isOnDown=!0,t.isOnMoving=!1,clearTimeout(timer),t.timerTime=0)}},e.prototype.removeTimer=function(){var e=this.metaObj;clearTimeout(e.timer),e.timerTime=0};