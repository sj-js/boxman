function t(e){var o=this;return this.objs={},this.boxObjs={},this.exBoxObjs={},this.keyboarder=new r(this),this.afterDetectFuncList=[],this.addedEventFuncs={},this.globalSetup={modeCopy:!1,modeOnlyBoxToBox:!0,modeRemoveOutOfBox:!1,appendType:t.APPEND_TYPE_LAST},this.globalSetupForBox={},this.globalSetupForObj={},this.globalSetupForExBox={},this.metaObj={mvObj:void 0,isOnDown:!1,isOnMoving:!1,lastPosX:0,lastPosY:0,mvObjPreviewClone:void 0,mvObjPreviewOriginalClone:void 0,mvObjStartBodyOffset:void 0,mvObjCloneList:[],mvObjOriginalShelterList:[],cam:{w:window.innerWidth,h:window.innerHeight},limit:2,layerOnMove:void 0,mode:new n(this.globalSetup)},e&&this.set(e),getEl().ready(function(){getEl().resize(function(){o.setMaxSize()}),o.setMaxSize(),o.isMobile()?(getEl(document).addEventListener("touchstart",function(t){o.whenMouseDown(t)}),getEl(document).addEventListener("touchmove",function(t){o.whenMouseMove(t)}),getEl(document).addEventListener("touchend",function(t){o.whenMouseUp(t)})):(getEl(document).addEventListener("mousedown",function(t){o.whenMouseDown(t)}),getEl(document).addEventListener("mousemove",function(t){o.whenMouseMove(t)}),getEl(document).addEventListener("mouseup",function(t){o.whenMouseUp(t)}))}),this}function e(t){this.limit,this.acceptbox=[],this.rejectbox=[],this.acceptobj=[],this.rejectobj=[],this.conditionbox=[],this.conditionobj=[],this.beforeboxin,this.boxinout,this.start,this.boxin,this.boxout,this.mode=new n}function o(t){}function i(t){}function n(t){this.modes={},this.set(t)}function r(t){var e=this;this.boxMan=t,this.selectorBox,this.targetBox,this.meta={goingToBeInThisBox:null,isEventStarted:!1,keborderStatus:e.STATUS_NONE}}t.APPEND_TYPE_LAST=1,t.APPEND_TYPE_FIRST=2,t.APPEND_TYPE_BETWEEN=3,t.APPEND_TYPE_OVERWRITE=4,t.APPEND_TYPE_SWAP=5,t.APPEND_TYPE_INVISIBLE=6,t.prototype.set=function(t){for(var e in t)this.globalSetup[e]=t[e]},t.prototype.clone=function(t){var e,o=getEl(t).obj,i=o.cloneNode(!0),n={};null!=o.getAttribute("data-box")?e=this.getBoxByManId(o.manid):null!=o.getAttribute("data-obj")?e=this.getObjByManId(o.manid):null!=o.getAttribute("data-exbox")&&(e=this.getExBoxByManId(o.manid));for(var r in e)n[r]=e[r];return this.setObj(i,n),i},t.prototype.detect=function(t){var e=this;return getEl().ready(function(){var o;o=document.querySelectorAll("[data-box]");for(var i=0;i<o.length;i++)e.addBox(o[i]);o=document.querySelectorAll("[data-exbox]");for(var i=0;i<o.length;i++)e.addExBox(o[i]);o=document.querySelectorAll("[data-obj]");for(var i=0;i<o.length;i++)e.addObj(o[i]);t&&t(e);for(var n=e.afterDetectFuncList,i=0;i<n.length;i++)n[i]()}),this},t.prototype.afterDetect=function(t){var e=this;return e.afterDetectFuncList.push(t),this},t.prototype.addEventListener=function(t,e){this.addedEventFuncs[t]||(this.addedEventFuncs[t]=[]),this.addedEventFuncs[t].push(e)},t.prototype.execEvent=function(t,e){var o=this.addedEventFuncs[t];if(o)for(var i=0;i<o.length;i++)o[i](e)},t.prototype.addBox=function(t){null==t.getAttribute("data-box")&&void 0==t.getAttribute("data-box")&&t.setAttribute("data-box","");var e={limit:t.getAttribute("data-limit"),acceptbox:getData(t.getAttribute("data-accept-box")).parse(),rejectbox:getData(t.getAttribute("data-reject-box")).parse(),acceptobj:getData(t.getAttribute("data-accept-obj")).parse(),rejectobj:getData(t.getAttribute("data-reject-obj")).parse(),conditionbox:[],conditionobj:[],beforeboxin:t.getAttribute("data-event-beforeboxin"),boxinout:t.getAttribute("data-event-boxinout"),start:t.getAttribute("data-event-start"),boxin:t.getAttribute("data-event-boxin"),boxout:t.getAttribute("data-event-boxout")};this.setBox(t,e)},t.prototype.newBox=function(t){var e,o=getNewEl("div","","",{"data-box":"true"},"");return e=t.parent?"string"==typeof parent?document.getElementById(t.parent):t.parent:t.parentEl?t.parentEl:document.body,this.setBox(o,t,e),o},t.prototype.setBox=function(t,e,o){if(t=getEl(t).obj,e=e?e:{},t.isAdaptedBox)return!1;t.isAdaptedBox=!0,getEl(t).clas.add("sj-obj-box");var i=this.boxObjs,r=e.manid?e.manid:getEl(i).getNewSeqId("tmpBox");t.manid=r,this.boxObjs[r]=e,this.boxObjs[r].el=t,this.boxObjs[r].id=t.id,this.boxObjs[r].manid=r,this.boxObjs[r].mode=new n;var a=this.globalSetupForBox,s=e?e:{};for(var d in a)s[d]||(s[d]=a[d]);return s&&(s.imgURL&&(t.style.background='url("'+s.imgURL+'")'),s.width&&s.height&&(t.style.backgroundSize=s.width+" "+s.height),s.width&&(t.style.width=s.width),s.height&&(t.style.height=s.height),s.content&&(t.innerHTML=s.content)),o&&getEl(o).add(t),s.beforeboxin&&(t.executeEventBeforeboxin=new Function("box","obj","boxsize",eventFn)),s.beforeboxinout&&(t.executeEventBoxinout=new Function("box","obj","boxSize","boxBefore",eventFn)),s.start&&(t.executeEventStart=new Function("box","obj","boxSize",eventFn),t.executeEventStart(obj,void 0,this.getMovableObjCount(obj))),s.boxin&&(t.executeEventBoxin=new Function("box","obj","boxSize","boxBefore",eventFn)),s.boxout&&(t.executeEventBoxout=new Function("box","obj","boxSize",eventFn)),r},t.prototype.delBox=function(t){var e=this.getBox(t),o=e.el,i=o.manid;return delete this.boxObjs[i],o.parentNode.removeChild(o),this},t.prototype.getBox=function(t){if("string"==typeof t)return this.getBoxById(t);if(t instanceof Element)return this.getBoxByEl(t);var e=this.getBoxesByCondition(t);return null!=e&&e.length>0?e[0]:void 0},t.prototype.getElementByBox=function(t){var e=this.getBox(t);return e.el},t.prototype.setBoxMode=function(t,e){for(var o=this.getBoxesByCondition(t),i=0;i<o.length;i++){var n=o[i];n.mode.set(e)}return this},t.prototype.getBoxById=function(t){var e=document.getElementById(t);return this.boxObjs[e.manid]},t.prototype.getBoxByEl=function(t){var e=this.boxObjs;if(t&&t.manid){var o=t.manid,i=e[o];return i}},t.prototype.getBoxByManId=function(t){return this.boxObjs[t]},t.prototype.getBoxes=function(){return this.boxObjs},t.prototype.getBoxesByCondition=function(t){var e=[],o=this.boxObjs;for(var i in o){var n=o[i],r=getEl(n).find(t);r&&e.push(r)}return e},t.prototype.getBoxesByDomAttributeCondition=function(t){var e=[],o=this.boxObjs;for(var i in o){var n=o[i],r=n.el,a=getEl(r).findDomAttribute(t);a&&e.push(a)}return e},t.prototype.clearBox=function(t){var e=getEl(t).obj;return e.innerHTML="",this},t.prototype.addAcceptBox=function(t,e){for(var o=this.getBoxesByCondition(t),i=0;i<o.length;i++){var n=o[i];void 0!=n.acceptbox&&null!=n.acceptbox||(n.acceptbox=[]),n.acceptbox instanceof Array?e instanceof Array?n.acceptbox.concat(e):n.acceptbox.push(e):n.acceptbox=[n.acceptbox]}return this},t.prototype.addRejectBox=function(t,e){for(var o=this.getBoxesByCondition(t),i=0;i<o.length;i++){var n=o[i];void 0!=n.rejectbox&&null!=n.rejectbox||(n.rejectbox=[]),n.rejectbox instanceof Array?e instanceof Array?n.rejectbox.concat(e):n.rejectbox.push(e):n.rejectbox=[n.acceptbox]}return this},t.prototype.addConditionWithBox=function(t,e,o){for(var i=this.getBoxesByCondition(t),n=0;n<i.length;n++){var r=i[n];r.conditionbox.push({condition:e,data:o})}return this},t.prototype.getConditionData=function(t,e){var o={};if(null!=e&&e.length>0)for(var i=0;i<e.length;i++){var n=e[i],r=n.condition,a=n.data;if(getEl(t).isAccepted(r))for(var s in a)o[s]=a[s]}return o},t.prototype.addAcceptObj=function(t,e){for(var o=this.getBoxesByCondition(t),i=0;i<o.length;i++){var n=o[i];void 0!=n.acceptobj&&null!=n.acceptobj||(n.acceptobj=[]),n.acceptobj instanceof Array?e instanceof Array?n.acceptobj.concat(e):n.acceptobj.push(e):n.acceptobj=[n.acceptobj]}return this},t.prototype.addRejectObj=function(t,e){for(var o=this.getBoxesByCondition(t),i=0;i<o.length;i++){var n=o[i];void 0!=n.rejectobj&&null!=n.rejectobj||(n.rejectobj=[]),n.rejectobj instanceof Array?e instanceof Array?n.rejectobj.concat(e):n.rejectobj.push(e):n.rejectobj=[n.rejectobj]}return this},t.prototype.addConditionWithObj=function(t,e,o){for(var i=this.getBoxesByCondition(t),n=0;n<i.length;n++){var r=i[n];r.conditionobj.push({condition:conditionForBox,data:o})}return this},t.prototype.suspendBox=function(t,e){var o=getEl(t).obj,i=getEl(e).obj,n=i.offsetTop+i.offsetHeight,r=i.offsetLeft;o.style.position="absolute",o.style.top=n+"px",o.style.left=r+"px"},t.prototype.addExBox=function(t){null==t.getAttribute("data-exbox")&&void 0==t.getAttribute("data-exbox")&&t.setAttribute("data-exbox","");var e={id:t.getAttribute("data-exbox-id")};this.setExBox(t,e)},t.prototype.newExBox=function(t){var e,o=getNewEl("div","","",{"data-exbox":"true"},"");return e=t.parent?"string"==typeof parent?document.getElementById(t.parent):t.parent:t.parentEl?t.parentEl:document.body,this.setExBox(o,t,e),o},t.prototype.setExBox=function(t,e,o){if(e=e?e:{},t.isAdaptedExBox)return!1;t.isAdaptedExBox=!0,getEl(t).clas.add("sj-obj-exbox");var i=this,n=this.exBoxObjs,r=e.manid?e.manid:getEl(n).getNewSeqId("tmpExBox");t.manid=r,this.exBoxObjs[r]=e,this.exBoxObjs[r].el=t,this.exBoxObjs[r].id=t.id,this.exBoxObjs[r].manid=r;var a=this.globalSetupForExBox,s=e?e:{};for(var d in a)s[d]||(s[d]=a[d]);s&&(s.imgURL&&(t.style.background='url("'+s.imgURL+'")'),s.width&&s.height&&(t.style.backgroundSize=s.width+" "+s.height),s.width&&(t.style.width=s.width),s.height&&(t.style.height=s.height),s.content&&(t.innerHTML=s.content)),o&&getEl(o).add(t),getEl(t).clas.add("sj-obj-exbox"),getEl(t).addEventListener("dragenter",i.handleDragOver(i)),getEl(t).addEventListener("dragover",i.handleDragOver(i)),getEl(t).addEventListener("dragleave",i.handleDragOut(i)),getEl(t).addEventListener("drop",i.handleDrop(i));var l=t.getAttribute("data-exbox");return null!=l&&void 0!=l&&i.addEventListener("drop",new Function("event",l)),r},t.prototype.getExBox=function(t){return"string"==typeof t?this.getExBoxById(t):this.getExBoxByEl(t)},t.prototype.getElementByExBox=function(t){var e=this.getExBox(t);return e.el},t.prototype.delExBox=function(t){var e=this.getExBox(t),o=e.el,i=o.manid;return delete this.exBoxObjs[i],o.parentNode.removeChild(o),this},t.prototype.getExBoxes=function(){return this.exBoxObjs},t.prototype.getExBoxById=function(t){var e=document.getElementById(t);return this.exBoxObjs[e.manid]},t.prototype.getExBoxByManId=function(t){return this.exBoxObjs[t]},t.prototype.getExBoxByEl=function(t){var e=this.exBoxObjs;if(t&&t.manid){var o=t.manid,e=e[o];return e}},t.prototype.handleDragOver=function(t){return function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy";var e=t.target;e.style.background="#ffdddd"}},t.prototype.handleDragOut=function(t){return function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy";var e=t.target;e.style.background=""}},t.prototype.handleDrop=function(t){return function(e){e.stopPropagation(),e.preventDefault();var o=e.originalEvent?e.originalEvent.dataTransfer.files:e.dataTransfer?e.dataTransfer.files:"";e.exbox={files:o},t.execEvent("drop",e),e.target.style.background=""}},t.prototype.addObj=function(t){var e={manid:t.getAttribute("data-obj-id")};this.setObj(t,e)},t.prototype.newObj=function(t){var e,o=getNewEl("div","","",{"data-obj":"true"},"");return e=t.parent?"string"==typeof parent?document.getElementById(t.parent):t.parent:t.parentEl?t.parentEl:document.body,this.setObj(o,t,e),o},t.prototype.setObj=function(t,e,o){if(e=e?e:{},t.isAdaptedMovable)return!1;t.isAdaptedMovable=!0,getEl(t).clas.add("sj-obj-movable");var i=this,n=this.objs,r=getEl(n).getNewSeqId("tmpObj");t.manid=r,this.objs[r]=e,this.objs[r].el=t,this.objs[r].id=t.id,this.objs[r].manid=r;var a=this.globalSetupForObj,s=e?e:{};for(var d in a)s[d]||(s[d]=a[d]);return s&&(s.imgURL&&(t.style.background='url("'+s.imgURL+'")'),s.width&&s.height&&(t.style.backgroundSize=s.width+" "+s.height),s.width&&(t.style.width=s.width),s.height&&(t.style.height=s.height),s.content&&(t.innerHTML=s.content)),t.style.left=t.offsetLeft+"px",t.style.top=t.offsetTop+"px",o&&getEl(o).add(t),this.isMobile()?getEl(t).addEventListener("touchstart",function(e){i.objStartMove(e,t)}):getEl(t).addEventListener("mousedown",function(e){i.objStartMove(e,t)}),getEl(t).addEventListener("click",function(){}),r},t.prototype.delObj=function(t){var e=this.getObj(t),o=e.el,i=o.manid;return delete this.objs[i],o.parentNode.removeChild(o),this},t.prototype.delObjByBox=function(t){for(var e=this.getBox(t),o=e.el,i=0;i<o.children.length;i++){var n=o.children[i];null!=n.getAttribute("data-obj")&&this.delObj(n)}return this},t.prototype.getObj=function(t){if("string"==typeof t)return this.getObjById(t);if(t instanceof Element)return this.getObjByEl(t);var e=this.getObjsByCondition(t);return null!=e&&e.length>0?e[0]:void 0},t.prototype.getElementByObj=function(t){var e=this.getObj(t);return e.el},t.prototype.getObjs=function(){return this.objs},t.prototype.getObjsByCondition=function(t){var e=[],o=this.objs;for(var i in o){var n=o[i],r=getEl(n).find(t);r&&e.push(r)}return e},t.prototype.getObjById=function(t){var e=document.getElementById(t);return this.objs[e.manid]},t.prototype.getObjByManId=function(t){return this.objs[t]},t.prototype.getObjByEl=function(t){var e=this.objs;if(t&&t.manid){var o=t.manid,i=e[o];return i}},t.prototype.getObjsByBox=function(t){for(var e={},o=this.getBox(t),i=o.el,n=0;n<i.children.length;n++){var r=i.children[n];if(null!=r.getAttribute("data-obj")){var a=r.manid,s=this.objs[a];e[a]=s}}return e},t.prototype.getObjListByBox=function(t){for(var e=[],o=this.getBox(t),i=o.el,n=0;n<i.children.length;n++){var r=i.children[n];if(null!=r.getAttribute("data-obj")){var a=r.manid,s=this.objs[a];e.push(s)}}return e},t.prototype.getObjAttributeListByBox=function(t){for(var e=[],o=this.getBox(t),i=o.el,n=0;n<i.children.length;n++){var r=i.children[n];if(null!=r.getAttribute("data-obj")){var a=r.manid,s=this.objs[a];e.push(s.attribute)}}return e},t.prototype.moveAllToOtherBox=function(t,e){var o=getEl(t).obj,i=getEl(e).obj,n=this.getObjsByBox(o);for(var r in n){var a=n[r].el;i.appendChild(a)}},t.prototype.shellterToBox=function(t){for(var e=this.metaObj.mvObjOriginalShelterList,o=getEl(t).obj,i=0;i<e.length;i++){var n=e[i];o.appendChild(n)}},t.prototype.hasEvent=function(t){var e=this.addedEventFuncs[t];return e&&e.length>0},t.prototype.whenMouseDown=function(t){var e=this.metaObj;return e.isOnMoving=!1,!0},t.prototype.objStartMove=function(t,e){var o,i=this.metaObj;if(navigator.userAgent.indexOf("Firefox")!=-1&&t.preventDefault(),e!=window)o=e;else{var n=getEl(t.target).getParentEl("data-obj");n&&(o=n)}i.mvObj=o;var r=this.createPreviewer(o);i.mvObjPreviewClone=r,i.mvObjCloneList.push(r);var a=this.createPreviewer(o);i.mvObjPreviewOriginalClone=a,i.mvObjOriginalShelterList=[],this.saveInfoBeforeMove(o,t)},t.prototype.whenMouseMove=function(t){var e=this.metaObj,o=e.mvObj;e.timerObj&&!this.isInBox(e.timerObj,e.lastPosX,e.lastPosY)&&this.removeTimer(),e.isOnDown&&(this.setLastPos(t),t.preventDefault(),this.setPreviewer(o,t),this.setMovingState(o))},t.prototype.whenMouseUp=function(t){var e=this.metaObj,o=e.mvObj;if(this.removeTimer(),e.isOnDown&&(getEl(o).clas.remove("sj-obj-is-on-moving"),e.isOnDown=!1),e.isOnMoving){var i=this.getDecidedBox(o,this.boxObjs,e.lastPosX,e.lastPosY);i=i?i:e.layerOnMove,this.deletePreviewer(),this.deleteOriginalClonePreviewer(),this.moveObjTo(o,i),o.style.zIndex=e.mvObjBeforeIndex,0==e.additionalStartPosLeft&&0==e.additionalStartPosTop||(o.style.left=parseInt(o.style.left)-e.additionalStartPosLeft+"px",o.style.top=parseInt(o.style.top)-e.additionalStartPosTop+"px"),o=null}},t.prototype.getDecidedBox=function(t,e,o,i){var n,r,a=[],s=0,d=0,l=0;for(var u in e){var b=e[u].el;this.isInBox(b,o,i)&&t!=b&&a.push(b)}for(var h=0;h<a.length;h++){var c=a[h].parentNode,v=0,p=!1,f=!1,g=0;for("fixed"==a[h].style.position&&(f=!0);c;){if(c==t){p=!0;break}if(!this.isInBox(c,o,i)&&c!=document.body&&c!=document.body.parentNode&&c!=document.body.parentNode.parentNode){p=!0;break}c.style&&"fixed"==c.style.position&&(f=!0),c=c.parentNode,v++,c&&c.getAttribute&&null!=c.getAttribute("data-pop")&&(g=c.popIndex)}if(!p){if(l<g)l=g,s=v,n=a[h];else if(!(l=g))continue;f?d<v&&(d=v,r=a[h]):s<v&&(s=v,n=a[h])}}return r?r:n},t.prototype.getMovableObjCount=function(t){var e=0;if(t)for(var o=0;o<t.children.length;o++){var i=t.children[o].getAttribute("data-obj");null!=i&&void 0!=i&&"false"!=i&&e++}return e},t.prototype.getMovableObj=function(t,e){var o=this.metaObj;if(t)for(var i=0;i<t.children.length;i++){var n=t.children[i],r=n.getAttribute("data-obj"),a=n.getAttribute("data-obj-previewer");if((null!=a||null!=r&&void 0!=r&&"false"!=r)&&this.isInBox(n,o.lastPosX,o.lastPosY))return n}},t.prototype.saveInfoBeforeMove=function(t,e){var o=this.metaObj;if(o.mvObjBeforeBox=t.parentNode,o.mvObjBeforeIndex=t.style.zIndex,o.mvObjBeforePosition=t.style.position,o.mvObjBeforeNextSibling=t.nextSibling,o.mvObjStartBodyOffset=getEl(t).getBoundingClientRect(),t.style.zIndex=getData().findHighestZIndex(["div"])+1,o.lastGoingToBeInThisBox=o.mvObjBeforeBox,o.mode.clear().merge(this.globalSetup).merge(this.getBox(o.mvObjBeforeBox).mode),t.parentNode!=document.body){var i=this.findAbsoluteParentEl(t),n=getEl(i).getBoundingClientRect();o.additionalStartPosLeft=n.left,o.additionalStartPosTop=n.top}else o.additionalStartPosLeft=0,o.additionalStartPosTop=0;this.setLastPos(e),void 0!=e.touches?(o.timerObj=e.touches[0].target,this.removeTimer(),o.timer=setInterval(setTimer,100),t.adjustX=e.touches[0].pageX-o.mvObjStartBodyOffset.left,t.adjustY=e.touches[0].pageY-o.mvObjStartBodyOffset.top):(t.adjustX=e.clientX-o.mvObjStartBodyOffset.left+getEl().getBodyScrollX(),t.adjustY=e.clientY-o.mvObjStartBodyOffset.top+getEl().getBodyScrollY(),getEl(t).clas.add("sj-obj-is-on-moving"),o.isOnDown=!0,o.isOnMoving=!1)},t.prototype.setMovingState=function(t){var e=this.metaObj,o=e.lastPosX,i=e.lastPosY,n=e.cam,r="px";o-t.adjustX>=1&&o-t.adjustX+t.offsetWidth<=n.w?t.style.left=o-t.adjustX+r:(o-t.adjustX<1&&(t.style.left=0+r),o-t.adjustX+t.offsetWidth>n.w&&(t.style.left=n.w-t.offsetWidth+r)),i-t.adjustY>=1&&i-t.adjustY+t.offsetHeight<=n.h?t.style.top=i-t.adjustY+r:(i-t.adjustY<1&&(t.style.top=0+r),i-t.adjustY+t.offsetHeight>n.h&&(t.style.top=n.h-t.offsetHeight+r)),t.style.position="absolute",t.style["float"]="",getEl(t).clas.add("sj-obj-is-on-moving"),getEl(document.body).add(t),e.isOnMoving||((t.adjustX>t.offsetWidth||t.adjustX<0)&&(t.adjustX=t.offsetWidth),(t.adjustY>t.offsetHeight||t.adjustY<0)&&(t.adjustY=t.offsetHeight)),e.isOnMoving=!0},t.prototype.moveObjTo=function(e,o){var i=this.metaObj,n=i.mode,r=i.mvObjBeforeBox,a=i.mvObjPreviewClone,s=(i.mvObjPreviewOriginalClone,this.getBox(r)),d=this.getBox(o),l=this.getObj(e),u=void 0!=s,b=void 0!=d,h=s==d,c=!1;if(b){var v=this.getConditionData(s,d.conditionbox),p=this.getConditionData(l,d.conditionobj);n.merge(v),n.merge(p),c=d.limit>this.getMovableObjCount(o)||void 0==d.limit}var f=n.get("appendType"),g=n.get("modeRemoveOutOfBox"),x=n.get("modeOnlyBoxToBox"),j=n.get("modeCopy"),B=f==t.APPEND_TYPE_BETWEEN,y=!B&&(h||!c),m=B&&!c&&!h,E=b&&o.executeEventBeforeboxin&&!o.executeEventBeforeboxin(o,e,this.getMovableObjCount(r)),O=g&&!b&&!h,P=x&&!b&&u,T=!b||getEl(s).isAccepted(d.acceptbox,d.rejectbox),A=!b||getEl(l).isAccepted(d.acceptobj,d.rejectobj),S=!1,w=!1,C=!1;if(y||E||P||!T||!A){if(O&&!b)return void this.delObj(e);this.backToBefore(e,r,f)}else if(o){if(m)return void this.backToBefore(e,r,f);var I;if(j&&f!=t.APPEND_TYPE_SWAP&&!h){var N=this.clone(e);I=N,this.backToBefore(e,r,f)}else I=e;f!=t.APPEND_TYPE_OVERWRITE||h?f==t.APPEND_TYPE_SWAP&&!h&&c&&this.shellterToBox(r):this.clearBox(o),this.goTo(I,o,f,a),S=!0,w=!0,C=!0}else i.mvObjBeforeBox.appendChild(e);if(S||!P&&b){var D=this.getMovableObjCount(r);r.executeEventMustDo&&r.executeEventMustDo(),r.executeEventBoxinout&&r.executeEventBoxinout(r,e,D),r.executeEventBoxout&&r.executeEventBoxout(r,e,D)}if(w){var M=this.getMovableObjCount(o);o.executeEventMustDo&&o.executeEventMustDo(),o.executeEventBoxinout&&o.executeEventBoxinout(o,e,M,r),o.executeEventBoxin&&o.executeEventBoxin(o,e,M,r)}return e=null,C},t.prototype.goTo=function(e,o,i,n){if(i==t.APPEND_TYPE_LAST)o.appendChild(e);else if(i==t.APPEND_TYPE_FIRST)o.insertBefore(e,o.firstChild);else if(i==t.APPEND_TYPE_BETWEEN){var r=this.getMovableObj(o,event);r?r==n.nextSibling?o.insertBefore(e,r.nextSibling):r!=n&&o.insertBefore(e,r):o.appendChild(e)}else i==t.APPEND_TYPE_OVERWRITE?o.appendChild(e):i==t.APPEND_TYPE_SWAP?o.appendChild(e):i==t.APPEND_TYPE_INVISIBLE;e.style.position=""},t.prototype.backToBefore=function(e,o,i,n){if(!n||i==t.APPEND_TYPE_SWAP){var r=this.metaObj,a=r.mvObjBeforeNextSibling,s=r.mvObjBeforePosition,d=r.mvObjStartBodyOffset;o.insertBefore(e,a),e.style.position="absolute"==s?"absolute":"","absolute"==s&&(e.style.left=d.x+"px",e.style.top=d.y+"px",e.style["float"]="")}},t.prototype.originalCopyBackToBefore=function(e,o,i,n){if(n&&i!=t.APPEND_TYPE_SWAP){if(e.parentNode!=o){if(!n||i==t.APPEND_TYPE_SWAP)return;var r=this.metaObj,a=r.mvObjBeforeNextSibling,s=r.mvObjBeforePosition,d=r.mvObjStartBodyOffset;o.insertBefore(e,a),e.style.position="absolute"==s?"absolute":"","absolute"==s&&(e.style.left=d.x+"px",e.style.top=d.y+"px",e.style["float"]="")}}else e.parentNode&&e.parentNode.removeChild(e)},t.prototype.createPreviewer=function(t){var e=(this.metaObj,t.cloneNode(!0));return e.setAttribute("data-obj","false"),e.setAttribute("data-obj-previewer","true"),getEl(e).clas.add("sj-preview-going-to-be-in-box"),e.style.position="",e},t.prototype.setPreviewer=function(e,o){var i=this.metaObj,n=i.mode.clone(),r=i.lastGoingToBeInThisBox,a=i.mvObjPreviewClone,s=i.mvObjPreviewOriginalClone,d=i.mvObjBeforeBox,l=this.getDecidedBox(e,this.boxObjs,i.lastPosX,i.lastPosY),u=l,b=this.getBox(d),h=this.getBox(u),c=this.getObj(e),v=void 0!=b,p=void 0!=h,f=b==h,g=!1;if(p){var x=this.getConditionData(b,h.conditionbox),j=this.getConditionData(c,h.conditionobj);n.merge(x),n.merge(j),g=h.limit>this.getMovableObjCount(u)||void 0==h.limit}var B=n.get("appendType"),y=n.get("modeRemoveOutOfBox"),m=n.get("modeOnlyBoxToBox"),E=n.get("modeCopy"),O=B==t.APPEND_TYPE_BETWEEN,P=!O&&(f||!g),T=O&&!g&&!f,A=(p&&u.executeEventBeforeboxin&&!u.executeEventBeforeboxin(u,e,this.getMovableObjCount(d)),!O&&m&&!p&&v),S=!p||getEl(b).isAccepted(h.acceptbox,h.rejectbox),w=!p||getEl(c).isAccepted(h.acceptobj,h.rejectobj);if(P||A||!S||!w){if(y&&!f&&!p)return a.parentNode&&a.parentNode.removeChild(a),this.originalCopyBackToBefore(s,d,B,E),this.overWriteAndSwapPreview(l,B),void(i.lastGoingToBeInThisBox=l);if(!S||!w)return i.lastGoingToBeInThisBox=l,this.originalCopyBackToBefore(s,d,B,E),void this.backToBefore(a,d,B,E);this.originalCopyBackToBefore(s,d,B,E),this.overWriteAndSwapPreview(l,B),i.lastGoingToBeInThisBox=l,this.backToBefore(a,d,B,E)}else if(u){if(T)return this.backToBefore(a,d,B,E),void(i.lastGoingToBeInThisBox=l);this.originalCopyBackToBefore(s,d,B,E),B!=t.APPEND_TYPE_OVERWRITE||f?B==t.APPEND_TYPE_SWAP&&!f&&g&&this.overWriteAndSwapPreview(l,B):(E&&a.parentNode&&a.parentNode.removeChild(a),this.overWriteAndSwapPreview(l,B)),this.goTo(a,l,B,a)}else r&&getEl(r).clas.remove("sj-tree-box-to-go"),a.parentNode&&a.parentNode.removeChild(a),this.overWriteAndSwapPreview(l,B);i.lastGoingToBeInThisBox=l},t.prototype.deletePreviewer=function(){var t=this.metaObj,e=t.mvObjPreviewClone,o=t.mvObjCloneList;e&&e.parentNode&&(e.parentNode.removeChild(e),e=void 0);for(var i=0;i<o.length;i++)o[i].parentNode&&o[i].parentNode.removeChild(o[i]);o.length>10&&(t.mvObjCloneList=[])},t.prototype.deleteOriginalClonePreviewer=function(){var t=this.metaObj,e=t.mvObjPreviewOriginalClone;e.parentNode&&e.parentNode.removeChild(e)},t.prototype.overWriteAndSwapPreview=function(e,o){var i=this.metaObj;if(i.lastGoingToBeInThisBox!=e){for(var n=0;n<i.mvObjOriginalShelterList.length;n++){var r=i.mvObjOriginalShelterList[n];i.mvObjOriginalBox.appendChild(r)}if(this.deletePreviewer(),e){i.mvObjOriginalBox=e,i.mvObjOriginalShelterList=[];var a=this.getObjsByBox(e);if(a){for(var s in a){var d=a[s];if(d){var l=d.el;i.mvObjOriginalShelterList.push(l)}}if(this.clearBox(e),o==t.APPEND_TYPE_SWAP)for(var n=0;n<i.mvObjOriginalShelterList.length;n++){var r=i.mvObjOriginalShelterList[n],u=this.createPreviewer(r);i.mvObjCloneList.push(u),i.mvObjBeforeBox.appendChild(u)}}}}},t.prototype.isMobile=function(){var t="win16|win32|win64|mac",e=!1;return navigator.platform&&(e=t.indexOf(navigator.platform.toLowerCase())<0),e},t.prototype.setMaxSize=function(t){var e=this.metaObj,o=document.createElement("div");o.style.display="block",o.style.position="absolute",o.style.top="-7777px",o.style.left="-7777px",o.style.width="100%",o.style.height="100%",o.style.border="0px solid",o.style.padding="0px",o.style.margin="0px",getEl(document.body).add(o);var i=o.offsetWidth,n=o.offsetHeight;e.cam.w=i,e.cam.h=n},t.prototype.setLastPos=function(t){var e=this.metaObj;void 0!=t.touches?(e.lastPosX=t.touches[0].pageX,e.lastPosY=t.touches[0].pageY):(e.lastPosX=t.clientX+getEl().getBodyScrollX(),e.lastPosY=t.clientY+getEl().getBodyScrollY())},t.prototype.isInBox=function(t,e,o){var i=getEl(t).getBoundingClientRect(),n=i.left,r=i.top;return n+t.scrollLeft<e&&n+t.offsetWidth+t.scrollLeft>e&&r+t.scrollTop<o+t.scrollTop&&r+t.offsetHeight+t.scrollTop>o+t.scrollTop},t.prototype.setTimer=function(t){var e=this.metaObj;return function(t){e.timerTime+=100,e.timerTime>=e.timeForReadyToDrag&&(t.preventDefault(t),getEl(e.mvObj).clas.add("sj-obj-is-on-moving"),e.isOnDown=!0,e.isOnMoving=!1,clearTimeout(timer),e.timerTime=0)}},t.prototype.removeTimer=function(){var t=this.metaObj;clearTimeout(t.timer),t.timerTime=0},t.prototype.findAbsoluteParentEl=function(t){for(var e=t.parentNode;e&&(!e.style||!e.style.position||"absolute"!=e.style.position);)e=e.parentNode;return e?e:document.body},t.prototype.getKeyboarder=function(){return this.keyboarder},n.prototype={set:function(t){if(t instanceof Object)for(var e in t)this.modes[e]=t[e];else"string"==typeof t&&(this.modes[t]=!0);return this},get:function(t){return this.modes[t]},del:function(t){return delete this.modes[t],this},toggle:function(t){var e=this.modes[t];return void 0!=this.modes[t]&&null!=this.modes[t]&&"boolean"==typeof e&&(this.modes[t]=!e),this},clear:function(){return this.modes={},this},clone:function(){return new n(this.modes)},merge:function(t){if(t instanceof n){var e=t.modes;for(var o in e)this.modes[o]=e[o]}else this.set(t);return this}},r.prototype={STATUS_NONE:0,STATUS_MOVE:1,STATUS_DROP:2,setSelectorBox:function(t){var e=this,o=this.meta;this.delSelectorBox();var t=this.boxMan.getBox(t),i=t.el;this.selectorBox=t,i.setAttribute("data-status","selected"),o.isEventStarted||(o.isEventStarted=!0,getEl(document).addEventListener("keydown",function(t){null!=e.selectorBox&&void 0!=e.selectorBox&&(38==t.keyCode&&e.selectPrevObjInBox(e.selectorBox.el),40==t.keyCode&&e.selectNextObjInBox(e.selectorBox.el),17==t.keyCode&&e.handleKeyborderControler(e.selectorBox.el))}))},delSelectorBox:function(t){var e;if(e=null!=t&&""!=t?this.boxMan.getBox(t):this.selectorBox,null!=e&&void 0!=e){var o=e.el;if(null!=o&&void 0!=o&&"selected"==o.getAttribute("data-status")){o.removeAttribute("data-status"),this.selectorBox=void 0;var i=this.getSelectedObjInBox(o);i&&i.el&&i.el.removeAttribute("data-status")}}},setTargetBox:function(t){},handleKeyborderControler:function(t){this.keborderStatus==this.STATUS_NONE?this.keborderStatus=this.STATUS_MOVE:this.keborderStatus==this.STATUS_MOVE&&(this.keborderStatus=this.STATUS_DROP,this.keborderStatus=this.STATUS_NONE)},selectNextObjInBox:function(t){var e=this.getSelectedObjIndexInBox(t);return this.deselectObjAllInBox(t),this.selectObjInBoxByIndex(t,e+1),this},selectPrevObjInBox:function(t){var e=this.getSelectedObjIndexInBox(t);return this.deselectObjAllInBox(t),this.selectObjInBoxByIndex(t,e-1),this},deselectObjAllInBox:function(t){for(var e=this.boxMan.getBox(t),o=e.el,i=0;i<o.children.length;i++){var n=o.children[i];null!=n.getAttribute("data-obj")&&null!=n.getAttribute("data-status")&&n.removeAttribute("data-status")}return this},selectObjInBoxByIndex:function(t,e){var o=this.boxMan.getBox(t),i=o.el,n=i.children.length,r=-1;e=e>0?e:0,e=e<n?e:n-1;for(var a=0;a<i.children.length;a++){var s=i.children[a];if(null!=s.getAttribute("data-obj")&&++r==e){s.setAttribute("data-status","selected");break}}return this},getSelectedObjInBox:function(t){for(var e,o=this.boxMan.getBox(t),i=o.el,n=-1,r=0;r<i.children.length;r++){var a=i.children[r];if(null!=a.getAttribute("data-obj")&&(n++,null!=a.getAttribute("data-status"))){e=a;break}}return this.boxMan.getObj(e)},getSelectedObjIndexInBox:function(t){for(var e=this.boxMan.getBox(t),o=e.el,i=-1,n=i,r=0;r<o.children.length;r++){var a=o.children[r];if(null!=a.getAttribute("data-obj")&&(i++,null!=a.getAttribute("data-status"))){n=i;break}}return n}};