function e(e){var t=this;this.addedEventFuncs={},this.objs={},this.boxObjs=[],this.metaObj={mvObj:void 0,isOnDown:!1,isOnMoving:!1,lastPosX:0,lastPosY:0,mvObjPreviewClone:void 0,mvObjStartBodyOffset:void 0,mvObjCloneList:[],cam:{w:window.innerWidth,h:window.innerHeight},isCopy:!0,isOverwrite:!1},window.addEventListener("load",function(e){t.setMaxSize(),t.isMobile()?(getEl(document).addEventListener("touchstart",function(e){t.whenMouseDown(e)}),getEl(document).addEventListener("touchmove",function(e){t.whenMouseMove(e)}),getEl(document).addEventListener("touchend",function(e){t.whenMouseUp(e)})):(getEl(document).addEventListener("mousedown",function(e){t.whenMouseDown(e)}),getEl(document).addEventListener("mousemove",function(e){t.whenMouseMove(e)}),getEl(document).addEventListener("mouseup",function(e){t.whenMouseUp(e)}),window.addEventListener("resize",function(e){t.whenResize(e)}))})}window.getNewEl=function(e,t,o,n,i,s,r){var a=document.createElement(e);t&&(a.id=t),o&&a.setAttribute("class",o);for(var d in n)a.setAttribute(d,n[d]);return i&&(a.innerHTML=i),s&&getEl(a).addEventListener(s,function(e){r(e)}),a},window.getEl=function(e){var t="object"==typeof e?e:document.getElementById(e);return this.obj=t,this.attr=function(e,o){return o?(t.setAttribute(e,o),this):t.getAttribute(e)},this.clas=function(){var e={has:function(e){return t.className.indexOf(e)!=-1},add:function(o){return t.classList?t.classList.add(o):t.className+=" "+o+" ",e},remove:function(o){if(t.classList)t.classList.remove(o);else{for(var n=t.className.split(" ");n.indexOf(o)!=-1;)n.splice(n.indexOf(o),1);t.className=n.join(" ")}return e}};return e}(),this.findEl=function(e,o){for(var n=t.children,i=0;i<n.length;i++)if(n[i].getAttribute(e)==o)return n[i]},this.findParentEl=function(e,o){for(var n,i=t;i;){if(i==document.body.parentNode){n=null;break}if(i.getAttribute(e)==o){n=i;break}i=i.parentNode}return n},this.add=function(e){return"object"==typeof e?t.appendChild(e):t.innerHTML+=e,this},this.addln=function(e){return"object"==typeof e?t.appendChild(e):t.innerHTML+=e?e:"",t.appendChild(document.createElement("br")),this},this.hasEventListener=function(e){return t.hasEventListener(e)},this.removeEventListener=function(e,o){return t.removeEventListener(e,o),this},this.addEventListener=function(e,o){navigator.userAgent.indexOf("Firefox")!=-1&&t.addEventListener(e,function(e){window.event=e},!0),t.addEventListener?t.addEventListener(e,function(e){o(e)}):t.attachEvent("on"+e,function(e){!e.target&&e.srcElement&&(e.target=e.srcElement),o(e)})},this.del=function(e){return t.removeChild(e),this},this.html=function(e){return t.innerHTML=e,this},this.clear=function(){return t.innerHTML="",this},this.scrollDown=function(){return t.scrollTop=t.scrollHeight,this},this.hideDiv=function(){return t.style.display="block",t.style.position="absolute",t.style.left="-5555px",t.style.top="-5555px",this},this.showDiv=function(){return t.style.display="block",t.style.position="absolute",t.style.left="0px",t.style.top="0px",this},this.getNewSeqId=function(e){for(var o=1;o<5e4;o++){var n=e+o;if(!(n in t))return n}return null},this},e.prototype.isMobile=function(){var e="win16|win32|win64|mac",t=!1;return navigator.platform&&(t=e.indexOf(navigator.platform.toLowerCase())<0),t},e.prototype.setMaxSize=function(e){var t=this.metaObj,o=document.createElement("div");o.style.display="block",o.style.position="absolute",o.style.top="-5555px",o.style.left="-5555px",o.style.width="100%",o.style.height="100%",o.style.border="0px solid",o.style.padding="0px",o.style.margin="0px",getEl(document.body).add(o);var n=o.offsetWidth,i=o.offsetHeight;t.cam.w||(t.cam.w=n,t.cam.h=i)},e.prototype.setLastPos=function(e){var t=this.metaObj;void 0!=e.touches?(t.lastPosX=e.touches[0].pageX,t.lastPosY=e.touches[0].pageY):(t.lastPosX=e.clientX+this.getBodyScrollX(),t.lastPosY=e.clientY+this.getBodyScrollY())},e.prototype.isInBox=function(e,t,o){var n=this.getBodyOffset(e),i=n.x,s=n.y;return i+e.scrollLeft<t&&i+e.offsetWidth+e.scrollLeft>t&&s+e.scrollTop<o&&s+e.offsetHeight+e.scrollTop>o},e.prototype.getBodyScrollX=function(e){var t=0;return document.documentElement&&document.documentElement.scrollLeft&&(t=document.documentElement.scrollLeft),window.pageXOffset&&(bodyPageY=window.pageXOffset),document.body&&document.body.scrollLeft&&(t=document.body.scrollLeft),t},e.prototype.getBodyScrollY=function(e){var t=0;return document.documentElement&&document.documentElement.scrollTop&&(t=document.documentElement.scrollTop),window.pageYOffset&&(t=window.pageYOffset),document.body&&document.body.scrollTop&&(t=document.body.scrollTop),t},e.prototype.getBodyOffsetX=function(e){var t=0;return document.documentElement&&document.documentElement.offsetWidth?document.documentElement.offsetWidth:document.body&&document.body.offsetWidth?document.body.offsetWidth:t},e.prototype.getBodyOffsetY=function(e){var t=0;return document.documentElement&&document.documentElement.offsetHeight?document.documentElement.offsetHeight:document.body&&document.body.offsetHeight?document.body.offsetHeight:t},e.prototype.getBodyOffset=function(e){for(var t=0,o=0,n=e,i=e.parentNode;i;){if(i!=document.body.parentNode.parentNode&&i!=document.body.parentNode.parentNode.parentNode){var s=0,r=0;if(n!=document.body&&(s=n.scrollLeft,r=n.scrollTop),"absolute"==i.style.position)t+=n.offsetLeft-s,o+=n.offsetTop-r;else{if("fixed"==i.style.position||"fixed"==n.style.position){t+=n.offsetLeft+this.getBodyScrollX(),o+=n.offsetTop+this.getBodyScrollY();break}t+=n.offsetLeft-i.offsetLeft-s,o+=n.offsetTop-i.offsetTop-r}}n=i,i=i.parentNode}var a={x:t,y:o};return a},e.prototype.setTimer=function(e){var t=this.metaObj;return function(e){t.timerTime+=100,t.timerTime>=t.timeForReadyToDrag&&(e.preventDefault(e),getEl(t.mvObj).clas.add("sj-obj-is-on-moving"),t.isOnDown=!0,t.isOnMoving=!1,clearTimeout(timer),t.timerTime=0)}},e.prototype.removeTimer=function(){var e=this.metaObj;clearTimeout(e.timer),e.timerTime=0},e.prototype.whenMouseDown=function(e){var t=this.metaObj;return t.isOnMoving=!1,!0},e.prototype.objStartMove=function(e,t){var o,n=this.metaObj;if(navigator.userAgent.indexOf("Firefox")!=-1&&e.preventDefault(),t!=window)o=t;else{for(var i=e.target;i&&void 0==i.getAttribute("data-movable");)i=i.parentNode;i&&(o=i)}n.mvObj=o,this.createPreviewer(o),n.mvObjBeforeBox=o.parentNode,n.mvObjBeforePosition=o.style.position,n.mvObjBeforeNextSibling=o.nextSibling,this.setLastPos(e);var s=this.getBodyOffset(o);return n.mvObjStartBodyOffset=s,void 0!=e.touches?(n.timerObj=e.touches[0].target,this.removeTimer(),n.timer=setInterval(setTimer,100),o.adjustX=e.touches[0].pageX-s.x,void(o.adjustY=e.touches[0].pageY-s.y)):(o.adjustX=e.clientX-s.x+this.getBodyScrollX(),o.adjustY=e.clientY-s.y+this.getBodyScrollY(),getEl(o).clas.add("sj-obj-is-on-moving"),n.isOnDown=!0,n.isOnMoving=!1,void 0)},e.prototype.whenMouseMove=function(e){var t=this.metaObj,o=t.lastPosX,n=t.lastPosY,i=t.cam,s=t.mvObj;this.setLastPos(e),t.timerObj&&!this.isInBox(t.timerObj,t.lastPosX,t.lastPosY)&&this.removeTimer(),t.isOnDown&&(e.preventDefault(),this.setPreviewer(s),o-s.adjustX>=1&&o-s.adjustX+s.offsetWidth<=i.w?s.style.left=o-s.adjustX+"px":(o-s.adjustX<1&&(s.style.left="0px"),o-s.adjustX+s.offsetWidth>i.w&&(s.style.left=i.w-s.offsetWidth+"px")),n-s.adjustY>=1&&n-s.adjustY+s.offsetHeight<=i.h?s.style.top=n-s.adjustY+"px":(n-s.adjustY<1&&(s.style.top="0px"),n-s.adjustY+s.offsetHeight>i.h&&(s.style.top=i.h-s.offsetHeight+"px")),s.style.position="absolute",s.style["float"]="",getEl(s).clas.add("sj-obj-is-on-moving"),document.body.appendChild(s),t.isOnMoving||((s.adjustX>s.offsetWidth||s.adjustX<0)&&(s.adjustX=s.offsetWidth),(s.adjustY>s.offsetHeight||s.adjustY<0)&&(s.adjustY=s.offsetHeight)),t.isOnMoving=!0)},e.prototype.whenMouseUp=function(e){var t=this.metaObj,o=t.mvObjBeforeBox,n=t.mvObjBeforeNextSibling,i=t.mvObjBeforePosition,s=t.mvObjStartBodyOffset,r=t.mvObj;if(this.removeTimer(),t.isOnDown&&(getEl(r).clas.remove("sj-obj-is-on-moving"),t.isOnDown=!1),this.deletePreviewer(),t.isOnMoving){var a=this.getDecidedBox(r,this.boxObjs,t.lastPosX,t.lastPosY);if(void 0!=a){var d=""==a.getAttribute("data-box"),u=a.getAttribute("data-box")>this.getMovableObjCount(a),l=void 0!=a.getAttribute("data-tree-type");if(a==o||!d&&!u)o.insertBefore(r,n),r.style.position="absolute"==i?"absolute":"","absolute"==i&&(r.style.left=s.x+"px",r.style.top=s.y+"px",r.style["float"]="");else if(l){if(getEl(a).clas.remove("sj-tree-box-to-go"),a.executeEventDrop){targetTree=sj.treeMan.get(a.sjid),targetTree.repository[r.sjid]=sj.objMan.get(r.sjid),r.parentNode.removeChild(r);var c={mvObj:r,obj:sj.objMan.get(r.sjid),decidedBox:a,treeObj:targetTree,mvObjBeforeBox:o,path:sj.treeMan.getPath(a.sjid)};a.executeEventDrop(e,c)}}else if(a.executeEventBeforeboxin&&!a.executeEventBeforeboxin(a,r,this.getMovableObjCount(o)))o.insertBefore(r,n),r.style.position="absolute"==i?"absolute":"","absolute"==i&&(r.style.left=s.x+"px",r.style.top=s.y+"px",r.style["float"]="");else{if(t.isOverwrite&&(a.innerHTML=""),t.isCopy){var f=r.cloneNode(!0);a.appendChild(f),this.setObj("",f),f.style.position="",o.insertBefore(r,n),r.style.position="absolute"==i?"absolute":"","absolute"==i&&(r.style.left=s.x+"px",r.style.top=s.y+"px",r.style["float"]="")}else a.appendChild(r),r.style.position="";var v=this.getMovableObjCount(a),b=this.getMovableObjCount(o);o.executeEventMustDo&&o.executeEventMustDo(),o.executeEventBoxinout&&o.executeEventBoxinout(o,r,b),o.executeEventBoxout&&o.executeEventBoxout(o,r,b),a.executeEventMustDo&&a.executeEventMustDo(),a.executeEventBoxinout&&a.executeEventBoxinout(a,r,v,o),a.executeEventBoxin&&a.executeEventBoxin(a,r,v,o)}return void(r=null)}var b=this.getMovableObjCount(o);return o.executeEventMustDo&&o.executeEventMustDo(),o.executeEventBoxinout&&o.executeEventBoxinout(o,r,b),o.executeEventBoxout&&o.executeEventBoxout(o,r,b),void(r=null)}},e.prototype.getDecidedBox=function(e,t,o,n){for(var i,s,r=[],a=0,d=0,u=0;u<t.length;u++)this.isInBox(t[u],o,n)&&e!=t[u]&&r.push(t[u]);for(var u=0;u<r.length;u++){var l=r[u].parentNode,c=0,f=!1,v=!1;for("fixed"==r[u].style.position&&(v=!0);l;){if(l==e){f=!0;break}if(!this.isInBox(l,o,n)&&l!=document.body&&l!=document.body.parentNode&&l!=document.body.parentNode.parentNode){f=!0;break}l.style&&"fixed"==l.style.position&&(v=!0),l=l.parentNode,c++}f||(v?d<c&&(d=c,s=r[u]):a<c&&(a=c,i=r[u]))}return s?s:i},e.prototype.getMovableObjCount=function(e){var t=0;if(e)for(var o=0;o<e.children.length;o++){var n=e.children[o].getAttribute("data-movable");null!=n&&void 0!=n&&"false"!=n&&t++}return t},e.prototype.createPreviewer=function(e){var t=this.metaObj,o=e.cloneNode(!0);o.setAttribute("data-movable","false"),getEl(o).clas.add("sj-preview-going-to-be-in-box"),o.style.position="",t.mvObjPreviewClone=o,t.mvObjCloneList.push(o)},e.prototype.setPreviewer=function(e){var t,o,n,i=this.metaObj,s=i.lastGoingToBeInThisBox,r=i.mvObjPreviewClone,a=i.mvObjBeforeBox,d=i.mvObjBeforeNextSibling,u=i.mvObjBeforePosition,l=this.getDecidedBox(e,this.boxObjs,i.lastPosX,i.lastPosY);void 0!=l&&(t=""==l.getAttribute("data-box"),o=l.getAttribute("data-box")>this.getMovableObjCount(l),n=void 0!=l.getAttribute("data-tree-type")),void 0==l?(s&&getEl(s).clas.remove("sj-tree-box-to-go"),r.parentNode&&r.parentNode.removeChild(r)):n?(s&&getEl(s).clas.remove("sj-tree-box-to-go"),getEl(l).clas.add("sj-tree-box-to-go"),i.lastGoingToBeInThisBox=l):l==a||!t&&!o?(a.insertBefore(r,d),r.style.position=u,i.lastGoingToBeInThisBox=l):(l.appendChild(r),r.style.position="",i.lastGoingToBeInThisBox=l)},e.prototype.deletePreviewer=function(){var e=this.metaObj,t=e.mvObjPreviewClone,o=e.mvObjCloneList;t&&t.parentNode&&(t.parentNode.removeChild(t),t=void 0);for(var n=0;n<o.length;n++)o[n].parentNode&&o[n].parentNode.removeChild(o[n]);o.length>3&&(o=[])},e.prototype.detect=function(){function e(e){if(document.querySelectorAll)return document.querySelectorAll(e);if(document.getElementsByTagName){var t,o=e.indexOf("["),n=e.indexOf("]"),i=[];if(o!=-1&&n!=-1){t=e.substring(o+1,n);for(var s=["div","span","form","input","select","textarea"],r=0;r<s.length;r++)for(var a=document.getElementsByTagName(s[r]),d=0;d<a.length;d++)void 0!=a[d].getAttribute(t)&&i.push(a[d])}return i}}for(var t=e("[data-box]"),o=0;o<t.length;o++){var n=t[o];n.isAdaptedBox||(n.isAdaptedBox=!0,this.add(n))}for(var t=e("[data-movable]"),o=0;o<t.length;o++){var n=t[o];n.isAdaptedMovable||(n.isAdaptedMovable=!0,this.setObj("",n))}},e.prototype.addEventListener=function(e,t){this.addedEventFuncs[e]||(this.addedEventFuncs[e]=[]),this.addedEventFuncs[e].push(t)},e.prototype.execEvent=function(e,t){var o=this.addedEventFuncs[e];if(o)for(var n=0;n<o.length;n++)o[n](t)},e.prototype.add=function(e){getEl(e).clas.add("sj-obj-box"),this.boxObjs.push(e),e.isAdaptedBox=!0,null==e.getAttribute("data-box")&&void 0==e.getAttribute("data-box")&&e.setAttribute("data-box","");var t=e.getAttribute("data-event-beforeboxin");null!=t&&void 0!=t&&(e.executeEventBeforeboxin=new Function("box","obj","boxsize",t));var t=e.getAttribute("data-event-boxinout");null!=t&&void 0!=t&&(e.executeEventBoxinout=new Function("box","obj","boxSize","boxBefore",t));var t=e.getAttribute("data-event-start");null!=t&&void 0!=t&&(e.executeEventStart=new Function("box","obj","boxSize",t),e.executeEventStart(e,void 0,this.getMovableObjCount(e)));var t=e.getAttribute("data-event-boxin");null!=t&&void 0!=t&&(e.executeEventBoxin=new Function("box","obj","boxSize","boxBefore",t));var t=e.getAttribute("data-event-boxout");null!=t&&void 0!=t&&(e.executeEventBoxout=new Function("box","obj","boxSize",t))},e.prototype.newObj=function(e,t,o){var n=this.getNewEl,i=n("div","","",{"data-movable":"true"},""),s=getEl(sj.objMan.objs).getNewSeqId("doc");return i.style.background='url("'+imgURL+'")',i.style.backgroundSize=w+" "+h,i.style.width=w,i.style.height=h,i.sjid=s,getEl("docBox").add(i),s},e.prototype.setObj=function(e,t,o){var n=this,i=this.objs;e=e?e:getEl(i).getNewSeqId("tmp"),this.objs[e]=o,t.isAdaptedMovable=!0,getEl(t).clas.add("sj-obj-movable"),this.isMobile()?getEl(t).addEventListener("touchstart",function(e){n.objStartMove(e,t)}):getEl(t).addEventListener("mousedown",function(e){n.objStartMove(e,t)}),getEl(t).addEventListener("click",function(){}),t.style.left=t.offsetLeft+"px",t.style.top=t.offsetTop+"px"},e.prototype.getObj=function(e){return this.objs[e]},e.prototype.hasEvent=function(e){var t=this.addedEventFuncs[e];return t&&t.length>0};var t=function(e){"undefined"!=typeof e.ondragstart&&(e.ondragstart=function(){return!1}),"undefined"!=typeof e.onselectstart&&(e.onselectstart=function(){return!1}),"undefined"!=typeof e.oncontextmenu&&(e.oncontextmenu=function(){return!1}),"undefined"!=typeof e.style.MozUserSelect&&(document.body.style.MozUserSelect="none")};e.prototype.getNewEl=function(e,t,o,n,i,s,r){var a=document.createElement(e);t&&(a.id=t),o&&a.setAttribute("class",o);for(var d in n)a.setAttribute(d,n[d]);return i&&(a.innerHTML=i),s&&getEl(a).addEventListener(s,function(e){r(e)}),a},e.prototype.getEl=function(e){var t="object"==typeof e?e:document.getElementById(e);return this.obj=t,this.attr=function(e,o){return o?(t.setAttribute(e,o),this):t.getAttribute(e)},this.clas=function(){var e={has:function(e){return t.className.indexOf(e)!=-1},add:function(o){return t.classList?t.classList.add(o):t.className+=" "+o+" ",e},remove:function(o){if(t.classList)t.classList.remove(o);else{for(var n=t.className.split(" ");n.indexOf(o)!=-1;)n.splice(n.indexOf(o),1);t.className=n.join(" ")}return e}};return e}(),this.findEl=function(e,o){for(var n=t.children,i=0;i<n.length;i++)if(n[i].getAttribute(e)==o)return n[i]},this.findParentEl=function(e,o){for(var n,i=t;i;){if(i==document.body.parentNode){n=null;break}if(i.getAttribute(e)==o){n=i;break}i=i.parentNode}return n},this.add=function(e){return"object"==typeof e?t.appendChild(e):t.innerHTML+=e,this},this.addln=function(e){return"object"==typeof e?t.appendChild(e):t.innerHTML+=e?e:"",t.appendChild(document.createElement("br")),this},this.hasEventListener=function(e){return t.hasEventListener(e)},this.removeEventListener=function(e,o){return t.removeEventListener(e,o),this},this.addEventListener=function(e,o){navigator.userAgent.indexOf("Firefox")!=-1&&t.addEventListener(e,function(e){window.event=e},!0),t.addEventListener?t.addEventListener(e,function(e){o(e)}):t.attachEvent("on"+e,function(e){!e.target&&e.srcElement&&(e.target=e.srcElement),o(e)})},this.del=function(e){return t.removeChild(e),this},this.html=function(e){return t.innerHTML=e,this},this.clear=function(){return t.innerHTML="",this},this.scrollDown=function(){return t.scrollTop=t.scrollHeight,this},this.hideDiv=function(){return t.style.display="block",t.style.position="absolute",t.style.left="-5555px",t.style.top="-5555px",this},this.showDiv=function(){return t.style.display="block",t.style.position="absolute",t.style.left="0px",t.style.top="0px",this},this.getNewSeqId=function(e){for(var o=1;o<5e4;o++){var n=e+o;if(!(n in t))return n}return null},this};